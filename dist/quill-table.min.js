!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("quill")):"function"==typeof define&&define.amd?define(["quill"],t):"object"==typeof exports?exports.quillTable=t(require("quill")):e.quillTable=t(e.Quill)}(window,(function(e){return function(e){var t=window.webpackHotUpdatequillTable;window.webpackHotUpdatequillTable=function(e,o){!function(e,t){if(!x[e]||!N[e])return;for(var o in N[e]=!1,t)Object.prototype.hasOwnProperty.call(t,o)&&(b[o]=t[o]);0==--g&&0===w&&T()}(e,o),t&&t(e,o)};var o,l=!0,n="76a4c935bd85c778afac",i={},r=[],s=[];function a(e){var t=A[e];if(!t)return L;var l=function(l){return t.hot.active?(A[l]?-1===A[l].parents.indexOf(e)&&A[l].parents.push(e):(r=[e],o=l),-1===t.children.indexOf(l)&&t.children.push(l)):(console.warn("[HMR] unexpected require("+l+") from disposed module "+e),r=[]),L(l)},n=function(e){return{configurable:!0,enumerable:!0,get:function(){return L[e]},set:function(t){L[e]=t}}};for(var i in L)Object.prototype.hasOwnProperty.call(L,i)&&"e"!==i&&"t"!==i&&Object.defineProperty(l,i,n(i));return l.e=function(e){return"ready"===u&&h("prepare"),w++,L.e(e).then(t,(function(e){throw t(),e}));function t(){w--,"prepare"===u&&(y[e]||C(e),0===w&&0===g&&T())}},l.t=function(e,t){return 1&t&&(e=l(e)),L.t(e,-2&t)},l}function d(t){var l={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_selfInvalidated:!1,_disposeHandlers:[],_main:o!==t,active:!0,accept:function(e,t){if(void 0===e)l._selfAccepted=!0;else if("function"==typeof e)l._selfAccepted=e;else if("object"==typeof e)for(var o=0;o<e.length;o++)l._acceptedDependencies[e[o]]=t||function(){};else l._acceptedDependencies[e]=t||function(){}},decline:function(e){if(void 0===e)l._selfDeclined=!0;else if("object"==typeof e)for(var t=0;t<e.length;t++)l._declinedDependencies[e[t]]=!0;else l._declinedDependencies[e]=!0},dispose:function(e){l._disposeHandlers.push(e)},addDisposeHandler:function(e){l._disposeHandlers.push(e)},removeDisposeHandler:function(e){var t=l._disposeHandlers.indexOf(e);t>=0&&l._disposeHandlers.splice(t,1)},invalidate:function(){switch(this._selfInvalidated=!0,u){case"idle":(b={})[t]=e[t],h("ready");break;case"ready":E(t);break;case"prepare":case"check":case"dispose":case"apply":(m=m||[]).push(t)}},check:v,apply:S,status:function(e){if(!e)return u;c.push(e)},addStatusHandler:function(e){c.push(e)},removeStatusHandler:function(e){var t=c.indexOf(e);t>=0&&c.splice(t,1)},data:i[t]};return o=void 0,l}var c=[],u="idle";function h(e){u=e;for(var t=0;t<c.length;t++)c[t].call(null,e)}var p,b,f,m,g=0,w=0,y={},N={},x={};function q(e){return+e+""===e?+e:e}function v(e){if("idle"!==u)throw new Error("check() is only allowed in idle status");return l=e,h("check"),(t=1e4,t=t||1e4,new Promise((function(e,o){if("undefined"==typeof XMLHttpRequest)return o(new Error("No browser support"));try{var l=new XMLHttpRequest,i=L.p+""+n+".hot-update.json";l.open("GET",i,!0),l.timeout=t,l.send(null)}catch(e){return o(e)}l.onreadystatechange=function(){if(4===l.readyState)if(0===l.status)o(new Error("Manifest request to "+i+" timed out."));else if(404===l.status)e();else if(200!==l.status&&304!==l.status)o(new Error("Manifest request to "+i+" failed."));else{try{var t=JSON.parse(l.responseText)}catch(e){return void o(e)}e(t)}}}))).then((function(e){if(!e)return h(_()?"ready":"idle"),null;N={},y={},x=e.c,f=e.h,h("prepare");var t=new Promise((function(e,t){p={resolve:e,reject:t}}));b={};return C(0),"prepare"===u&&0===w&&0===g&&T(),t}));var t}function C(e){x[e]?(N[e]=!0,g++,function(e){var t=document.createElement("script");t.charset="utf-8",t.src=L.p+""+e+"."+n+".hot-update.js",document.head.appendChild(t)}(e)):y[e]=!0}function T(){h("ready");var e=p;if(p=null,e)if(l)Promise.resolve().then((function(){return S(l)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var o in b)Object.prototype.hasOwnProperty.call(b,o)&&t.push(q(o));e.resolve(t)}}function S(t){if("ready"!==u)throw new Error("apply() is only allowed in ready status");return function t(l){var s,a,d,c,u;function p(e){for(var t=[e],o={},l=t.map((function(e){return{chain:[e],id:e}}));l.length>0;){var n=l.pop(),i=n.id,r=n.chain;if((c=A[i])&&(!c.hot._selfAccepted||c.hot._selfInvalidated)){if(c.hot._selfDeclined)return{type:"self-declined",chain:r,moduleId:i};if(c.hot._main)return{type:"unaccepted",chain:r,moduleId:i};for(var s=0;s<c.parents.length;s++){var a=c.parents[s],d=A[a];if(d){if(d.hot._declinedDependencies[i])return{type:"declined",chain:r.concat([a]),moduleId:i,parentId:a};-1===t.indexOf(a)&&(d.hot._acceptedDependencies[i]?(o[a]||(o[a]=[]),g(o[a],[i])):(delete o[a],t.push(a),l.push({chain:r.concat([a]),id:a})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:o}}function g(e,t){for(var o=0;o<t.length;o++){var l=t[o];-1===e.indexOf(l)&&e.push(l)}}_();var w={},y=[],N={},v=function(){console.warn("[HMR] unexpected require("+T.moduleId+") to disposed module")};for(var C in b)if(Object.prototype.hasOwnProperty.call(b,C)){var T;u=q(C),T=b[C]?p(u):{type:"disposed",moduleId:C};var S=!1,E=!1,O=!1,I="";switch(T.chain&&(I="\nUpdate propagation: "+T.chain.join(" -> ")),T.type){case"self-declined":l.onDeclined&&l.onDeclined(T),l.ignoreDeclined||(S=new Error("Aborted because of self decline: "+T.moduleId+I));break;case"declined":l.onDeclined&&l.onDeclined(T),l.ignoreDeclined||(S=new Error("Aborted because of declined dependency: "+T.moduleId+" in "+T.parentId+I));break;case"unaccepted":l.onUnaccepted&&l.onUnaccepted(T),l.ignoreUnaccepted||(S=new Error("Aborted because "+u+" is not accepted"+I));break;case"accepted":l.onAccepted&&l.onAccepted(T),E=!0;break;case"disposed":l.onDisposed&&l.onDisposed(T),O=!0;break;default:throw new Error("Unexception type "+T.type)}if(S)return h("abort"),Promise.reject(S);if(E)for(u in N[u]=b[u],g(y,T.outdatedModules),T.outdatedDependencies)Object.prototype.hasOwnProperty.call(T.outdatedDependencies,u)&&(w[u]||(w[u]=[]),g(w[u],T.outdatedDependencies[u]));O&&(g(y,[T.moduleId]),N[u]=v)}var B,k=[];for(a=0;a<y.length;a++)u=y[a],A[u]&&A[u].hot._selfAccepted&&N[u]!==v&&!A[u].hot._selfInvalidated&&k.push({module:u,parents:A[u].parents.slice(),errorHandler:A[u].hot._selfAccepted});h("dispose"),Object.keys(x).forEach((function(e){!1===x[e]&&function(e){delete installedChunks[e]}(e)}));var R,M,D=y.slice();for(;D.length>0;)if(u=D.pop(),c=A[u]){var H={},j=c.hot._disposeHandlers;for(d=0;d<j.length;d++)(s=j[d])(H);for(i[u]=H,c.hot.active=!1,delete A[u],delete w[u],d=0;d<c.children.length;d++){var P=A[c.children[d]];P&&((B=P.parents.indexOf(u))>=0&&P.parents.splice(B,1))}}for(u in w)if(Object.prototype.hasOwnProperty.call(w,u)&&(c=A[u]))for(M=w[u],d=0;d<M.length;d++)R=M[d],(B=c.children.indexOf(R))>=0&&c.children.splice(B,1);h("apply"),void 0!==f&&(n=f,f=void 0);for(u in b=void 0,N)Object.prototype.hasOwnProperty.call(N,u)&&(e[u]=N[u]);var U=null;for(u in w)if(Object.prototype.hasOwnProperty.call(w,u)&&(c=A[u])){M=w[u];var W=[];for(a=0;a<M.length;a++)if(R=M[a],s=c.hot._acceptedDependencies[R]){if(-1!==W.indexOf(s))continue;W.push(s)}for(a=0;a<W.length;a++){s=W[a];try{s(M)}catch(e){l.onErrored&&l.onErrored({type:"accept-errored",moduleId:u,dependencyId:M[a],error:e}),l.ignoreErrored||U||(U=e)}}}for(a=0;a<k.length;a++){var z=k[a];u=z.module,r=z.parents,o=u;try{L(u)}catch(e){if("function"==typeof z.errorHandler)try{z.errorHandler(e)}catch(t){l.onErrored&&l.onErrored({type:"self-accept-error-handler-errored",moduleId:u,error:t,originalError:e}),l.ignoreErrored||U||(U=t),U||(U=e)}else l.onErrored&&l.onErrored({type:"self-accept-errored",moduleId:u,error:e}),l.ignoreErrored||U||(U=e)}}if(U)return h("fail"),Promise.reject(U);if(m)return t(l).then((function(e){return y.forEach((function(t){e.indexOf(t)<0&&e.push(t)})),e}));return h("idle"),new Promise((function(e){e(y)}))}(t=t||{})}function _(){if(m)return b||(b={}),m.forEach(E),m=void 0,!0}function E(t){Object.prototype.hasOwnProperty.call(b,t)||(b[t]=e[t])}var A={};function L(t){if(A[t])return A[t].exports;var o=A[t]={i:t,l:!1,exports:{},hot:d(t),parents:(s=r,r=[],s),children:[]};return e[t].call(o.exports,o,o.exports,a(t)),o.l=!0,o.exports}return L.m=e,L.c=A,L.d=function(e,t,o){L.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},L.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},L.t=function(e,t){if(1&t&&(e=L(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(L.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)L.d(o,l,function(t){return e[t]}.bind(null,l));return o},L.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return L.d(t,"a",t),t},L.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},L.p="",L.h=function(){return n},a(1)(L.s=1)}([function(t,o){t.exports=e},function(e,t,o){e.exports=o(2)},function(e,t,o){"use strict";o.r(t);var l=o(0),n=o.n(l);function i(e,t){if("object"==typeof t)for(let o in t)e.style[o]=t[o]}function r(e,t){let o=t.getBoundingClientRect();return{x:e.x-o.x-t.scrollLeft,y:e.y-o.y-t.scrollTop,x1:e.x-o.x-t.scrollLeft+e.width,y1:e.y-o.y-t.scrollTop+e.height,width:e.width,height:e.height}}function s(e,t){return e&&Object.keys(e).reduce((o,l)=>t.includes(l)?o:Object.assign({},o,{[l]:e[l]}),{})}function a(e){let t;if(t=e.path||e.composedPath&&e.composedPath(),void 0===t&&e.target){t=[];let o=e.target;for(t.push(o);o&&o.parentNode;)o=o.parentNode,t.push(o)}return t}class d{constructor(e,t,o){if(!e)return null;this.table=e,this.quill=t,this.options=o,this.domNode=null,this.isTouchDevice=this.checkTouchDevice(),this.initColTool()}initColTool(){const e=this.quill.root.parentNode;this.domNode=document.createElement("div"),this.domNode.classList.add("quill-table-col-tool"),this.updateToolCells(),e.appendChild(this.domNode),this.updateToolWidth()}createToolCell(e=!0){const t=document.createElement("div");t.classList.add("quill-table-col-tool__cell");const o=document.createElement("div");return e&&this.setCellResizeHolderClass(o),i(t,{height:"12px"}),t.appendChild(o),t}setCellResizeHolderClass(e){e.classList.add("quill-table-col-tool__cell-holder")}updateToolWidth(){const e=this.table.parentNode.getBoundingClientRect(),t=this.quill.root.parentNode;i(this.domNode,{width:e.width+"px",height:"12px",left:this.table.offsetLeft+t.scrollLeft+"px",top:this.table.offsetTop+t.scrollTop-12+2+"px"})}updateToolCells(){return new Promise(e=>{setTimeout(()=>{const t=n.a.find(this.table),o=t.children.tail.children.head.children,l=t.colGroup().children,r=t.children.tail.domNode.clientWidth,s=function(e){return e.reduce((e,t)=>{const o=t.formats().colspan;return e+=parseInt(o,10)},0)}(o);let a=Array.from(this.domNode.querySelectorAll(".quill-table-col-tool__cell"));const d=Math.max(s,a.length);for(let e=0;e<d;e++){let t=l.at(e),o=t&&t.attributes.domNode.clientWidth,n=null;if(a[e])if(a[e]&&e>=s)a[e].remove();else{n=a[e];i(n,{width:o/r*100+"%"});const t=e+1;if(t===a.length&&t<d){const e=n.querySelector("div");if(!e)continue;this.setCellResizeHolderClass(e),this.addColCellHolderHandler(n)}}else{n=this.createToolCell(e+1!==d),this.domNode.appendChild(n),this.addColCellHolderHandler(n);i(n,{width:o/r*100+"%"})}}e()},0)})}destroy(){return this.domNode.remove(),null}addColCellHolderHandler(e){const t=n.a.find(this.table),o=e.querySelector(".quill-table-col-tool__cell-holder");let l=!1,r=0,s=0,a=0,d=0,c={},u={},h=null;const p=e=>{e.preventDefault(),l&&(s=this.getClientXFromEvent(e),a=d+s-r>=50?s-r:50-d,i(h,{left:u.left+u.width-1+a+"px"}))},b=n=>{n.preventDefault();const i=Array.from(this.domNode.querySelectorAll(".quill-table-col-tool__cell")).indexOf(e),f=t.colGroup().children.at(i),m=f.next,g=m.domNode.clientWidth;l&&(f.format("width",d+a),m.format("width",g-a),r=0,s=0,a=0,d=0,l=!1,o.classList.remove("dragging")),document.removeEventListener("mousemove",p,!1),document.removeEventListener("mouseup",b,!1),this.isTouchDevice&&(document.removeEventListener("touchmove",p,!1),document.removeEventListener("touchend",b,!1)),c={},u={},h.remove(),h=null,t.updateTableWidth();const w=this.quill.getModule("quill-table").tableSelection;w&&w.clearSelection(),this.updateToolCells()},f=t=>{document.addEventListener("mousemove",p,!1),document.addEventListener("mouseup",b,!1),this.isTouchDevice&&(document.addEventListener("touchmove",p,!1),document.addEventListener("touchend",b,!1)),c=this.table.getBoundingClientRect(),u=e.getBoundingClientRect(),h=document.createElement("div"),i(h,{position:"fixed",top:u.top+"px",left:u.left+u.width-1+"px",zIndex:"100",height:c.height+12+4+"px",width:"1px",backgroundColor:"#35A7ED"}),document.body.appendChild(h),l=!0,r=this.getClientXFromEvent(t),d=u.width,o.classList.add("dragging")};null!==o&&(o.addEventListener("mousedown",f,!1),this.isTouchDevice&&o.addEventListener("touchstart",f,!1))}colToolCells(){return Array.from(this.domNode.querySelectorAll(".quill-table-col-tool__cell"))}checkTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}getClientXFromEvent(e){return this.isTouchDevice?e.touches[0].clientX:e.clientX}}const c=n.a.import("blots/block");class u extends c{static create(e){"string"==typeof e&&(e={value:e});const t=super.create(e.value);return w.forEach(o=>{e[o]&&t.setAttribute("data-"+o,e[o])}),y.forEach(o=>{e[o]&&t.setAttribute("data-"+o,e[o])}),t}static formats(e){const t={};return t.value=this.tagName.indexOf(e.tagName)+1,y.concat(w).reduce((t,o)=>(e.hasAttribute("data-"+o)&&(t[o]=e.getAttribute("data-"+o)||void 0),t),t)}format(e,t){const{row:o,cell:l,rowspan:n,colspan:i}=u.formats(this.domNode);e===u.blotName?t?super.format(e,{value:t,row:o,cell:l,rowspan:n,colspan:i}):o?this.replaceWith(x.blotName,{row:o,cell:l,rowspan:n,colspan:i}):super.format(e,t):super.format(e,t)}optimize(){const{row:e,rowspan:t,colspan:o}=u.formats(this.domNode);if(!e||this.parent instanceof q||this.wrap(q.blotName,{row:e,colspan:o,rowspan:t}),this.enforceAllowedChildren(),null!=this.uiNode&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),0===this.children.length)if(null!=this.statics.defaultChild){const e=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(e)}else this.remove();this.cache={}}}u.blotName="header",u.tagName=["H1","H2","H3","H4","H5","H6"];var h=u;const p=n.a.import("blots/break"),b=n.a.import("blots/block"),f=n.a.import("blots/container"),m=["width"],g={width:100},w=["row","cell"],y=["rowspan","colspan"],N={rowspan:1,colspan:1};class x extends b{static create(e){const t=super.create(e);return w.forEach(o=>{let l="row"===o?A:L;t.setAttribute("data-"+o,e[o]||l())}),y.forEach(o=>{t.setAttribute("data-"+o,e[o]||N[o])}),e["cell-bg"]&&t.setAttribute("data-cell-bg",e["cell-bg"]),t}static formats(e){return y.concat(w).concat(["cell-bg"]).reduce((t,o)=>(e.hasAttribute("data-"+o)&&(t[o]=e.getAttribute("data-"+o)||void 0),t),{})}format(e,t){if(y.concat(w).indexOf(e)>-1)t?this.domNode.setAttribute("data-"+e,t):this.domNode.removeAttribute("data-"+e);else if("cell-bg"===e)t?this.domNode.setAttribute("data-cell-bg",t):this.domNode.removeAttribute("data-cell-bg");else if("header"===e){if(!t)return;const{row:o,cell:l,rowspan:n,colspan:i}=x.formats(this.domNode);super.format(e,{value:t,row:o,cell:l,rowspan:n,colspan:i})}else super.format(e,t)}optimize(e){const t=this.domNode.getAttribute("data-row"),o=this.domNode.getAttribute("data-rowspan"),l=this.domNode.getAttribute("data-colspan"),n=this.domNode.getAttribute("data-cell-bg");!this.statics.requiredContainer||this.parent instanceof this.statics.requiredContainer||this.wrap(this.statics.requiredContainer.blotName,{row:t,colspan:l,rowspan:o,"cell-bg":n}),super.optimize(e)}tableCell(){return this.parent}}x.blotName="table-cell-line",x.className="quill-table__cell-line",x.tagName="P";class q extends f{checkMerge(){if(super.checkMerge()&&null!=this.next.children.head){const e=this.children.head.formats()[this.children.head.statics.blotName],t=this.children.tail.formats()[this.children.tail.statics.blotName],o=this.next.children.head.formats()[this.next.children.head.statics.blotName],l=this.next.children.tail.formats()[this.next.children.tail.statics.blotName];return e.cell===t.cell&&e.cell===o.cell&&e.cell===l.cell}return!1}static create(e){const t=super.create(e);return t.setAttribute("data-row",e.row),y.forEach(o=>{e[o]&&t.setAttribute(o,e[o])}),e["cell-bg"]&&(t.setAttribute("data-cell-bg",e["cell-bg"]),t.style.backgroundColor=e["cell-bg"]),t}static formats(e){const t={};return e.hasAttribute("data-row")&&(t.row=e.getAttribute("data-row")),e.hasAttribute("data-cell-bg")&&(t["cell-bg"]=e.getAttribute("data-cell-bg")),y.reduce((t,o)=>(e.hasAttribute(o)&&(t[o]=e.getAttribute(o)),t),t)}cellOffset(){return this.parent?this.parent.children.indexOf(this):-1}formats(){const e={};return this.domNode.hasAttribute("data-row")&&(e.row=this.domNode.getAttribute("data-row")),this.domNode.hasAttribute("data-cell-bg")&&(e["cell-bg"]=this.domNode.getAttribute("data-cell-bg")),y.reduce((e,t)=>(this.domNode.hasAttribute(t)&&(e[t]=this.domNode.getAttribute(t)),e),e)}toggleAttribute(e,t){t?this.domNode.setAttribute(e,t):this.domNode.removeAttribute(e)}formatChildren(e,t){this.children.forEach(o=>{o.format(e,t)})}format(e,t){y.indexOf(e)>-1?(this.toggleAttribute(e,t),this.formatChildren(e,t)):["row"].indexOf(e)>-1?(this.toggleAttribute("data-"+e,t),this.formatChildren(e,t)):"cell-bg"===e?(this.toggleAttribute("data-cell-bg",t),this.formatChildren(e,t),this.domNode.style.backgroundColor=t||"initial"):super.format(e,t)}optimize(e){const t=this.domNode.getAttribute("data-row");!this.statics.requiredContainer||this.parent instanceof this.statics.requiredContainer||this.wrap(this.statics.requiredContainer.blotName,{row:t}),super.optimize(e)}row(){return this.parent}rowOffset(){return this.row()?this.row().rowOffset():-1}table(){return this.row()&&this.row().table()}}q.blotName="table",q.className="quill-table__cell",q.tagName="TD";class v extends f{checkMerge(){if(super.checkMerge()&&null!=this.next.children.head){const e=this.children.head.formats(),t=this.children.tail.formats(),o=this.next.children.head.formats(),l=this.next.children.tail.formats();return e.row===t.row&&e.row===o.row&&e.row===l.row}return!1}static create(e){const t=super.create(e);return t.setAttribute("data-row",e.row),t}formats(){return["row"].reduce((e,t)=>(this.domNode.hasAttribute("data-"+t)&&(e[t]=this.domNode.getAttribute("data-"+t)),e),{})}optimize(){!this.statics.requiredContainer||this.parent instanceof this.statics.requiredContainer||this.wrap(this.statics.requiredContainer.blotName),this.enforceAllowedChildren(),null!=this.uiNode&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),this.children.length>0&&null!=this.next&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}rowOffset(){return this.parent?this.parent.children.indexOf(this):-1}table(){return this.parent&&this.parent.parent}}v.blotName="table-row",v.tagName="TR";class C extends f{}C.blotName="table-body",C.tagName="TBODY";class T extends b{static create(e){let t=super.create(e);return m.forEach(o=>{t.setAttribute(""+o,e[o]||g[o])}),t}static formats(e){return m.reduce((t,o)=>(e.hasAttribute(""+o)&&(t[o]=e.getAttribute(""+o)||void 0),t),{})}formats(e){const t=super.formats();return e&&this.domNode.setAttribute("width",e),t}format(e,t){m.indexOf(e)>-1?this.domNode.setAttribute(""+e,t||g[e]):super.format(e,t)}html(){return this.domNode.outerHTML}}T.blotName="table-col",T.tagName="col";class S extends f{}S.blotName="table-col-group",S.tagName="colgroup";class _ extends f{static create(){return super.create()}constructor(e,t){super(e,t),this.updateTableWidth()}updateTableWidth(){setTimeout(()=>{const e=this.colGroup();if(!e)return;const t=this.domNode.clientWidth;e.children.reduce((e,o)=>{const l=(o.domNode.clientWidth/t*100).toFixed(2);return o.formats(l+"%"),null})},0)}cells(e){return this.rows().map(t=>t.children.at(e))}colGroup(){return this.children.head}deleteColumns(e,t=[],o){const[l]=this.descendants(C);if(null==l||null==l.children.head)return;const n=this.descendants(q),i=[],s=[];if(n.forEach(t=>{const l=r(t.domNode.getBoundingClientRect(),o);l.x+5>e.x&&l.x1-5<e.x1?i.push(t):l.x<e.x+5&&l.x1>e.x1-5&&s.push(t)}),i.length===n.length)return this.tableDestroy(),!0;t.forEach(()=>{this.colGroup().children.at(t[0]).remove()}),i.forEach(e=>{e.remove()}),s.forEach(e=>{const o=parseInt(e.formats().colspan,10);e.format("colspan",o-t.length)}),this.updateTableWidth()}deleteRow(e,t){const[o]=this.descendants(C);if(null==o||null==o.children.head)return;const l=this.descendants(q),n=this.descendants(v),i=[],s=[],a=[],d=n.filter(o=>{const l=r(o.domNode.getBoundingClientRect(),t);return l.y>e.y-5&&l.y1<e.y1+5});if(l.forEach(o=>{const l=r(o.domNode.getBoundingClientRect(),t);l.y>e.y-5&&l.y1<e.y1+5?i.push(o):l.y<e.y+5&&l.y1>e.y1-5&&(s.push(o),Math.abs(l.y-e.y)<5&&a.push(o))}),i.length===l.length)return void this.tableDestroy();const c=this.rows().reduce((o,l)=>{let n=r(l.domNode.getBoundingClientRect(),t);return n.y>e.y-5&&n.y1<e.y1+5&&(o+=1),o},0);a.forEach(e=>{const o=r(e.domNode.getBoundingClientRect(),t),l=e.parent.next,n=l.children.reduce((e,l)=>{const n=r(l.domNode.getBoundingClientRect(),t);return Math.abs(o.x1-n.x)<5&&(e=l),e},null);l.insertBefore(e,n),e.format("row",l.formats().row)}),i.forEach(e=>{e.remove()}),s.forEach(e=>{const t=parseInt(e.formats().rowspan,10);e.format("rowspan",t-c)}),d.forEach(e=>e.remove())}tableDestroy(){const e=n.a.find(this.scroll.domNode.parentNode),t=e.getModule("quill-table");this.remove(),t.hideTableTools(),e.update(n.a.sources.USER)}insertCell(e,t){const o=L(),l=e.formats().row,n=this.scroll.create(q.blotName,Object.assign({},N,{row:l})),i=this.scroll.create(x.blotName,{row:l,cell:o});n.appendChild(i),t?e.insertBefore(n,t):e.appendChild(n)}insertColumn(e,t,o=!0,l){const[n]=this.descendants(C),[i]=this.descendants(S),s=this.descendants(T);let a=[],d=[],c=[];if(null==n||null==n.children.head)return;this.descendants(q).forEach(t=>{const n=r(t.domNode.getBoundingClientRect(),l);o?Math.abs(n.x1-e.x1)<5?a.push(t):e.x1-n.x>5&&e.x1-n.x1<-5&&d.push(t):Math.abs(n.x-e.x)<5?a.push(t):e.x-n.x>5&&e.x-n.x1<-5&&d.push(t)}),a.forEach(e=>{const t=o?e.next:e,l=L(),n=e.parent,i=n.formats().row,r=e.formats(),s=this.scroll.create(q.blotName,Object.assign({},N,{row:i,rowspan:r.rowspan})),a=this.scroll.create(x.blotName,{row:i,cell:l,rowspan:r.rowspan});s.appendChild(a),t?n.insertBefore(s,t):n.appendChild(s),c.push(s)});const u=this.scroll.create(T.blotName,!0);let h=o?s[t].next:s[t];return h?i.insertBefore(u,h):i.appendChild(u),d.forEach(e=>{const t=e.formats().colspan;e.format("colspan",parseInt(t,10)+1),c.push(e)}),c.sort((e,t)=>e.domNode.getBoundingClientRect().y-t.domNode.getBoundingClientRect().y),this.updateTableWidth(),c}insertRow(e,t,o){const[l]=this.descendants(C);if(null==l||null==l.children.head)return;const n=this.descendants(q),i=A(),s=this.scroll.create(v.blotName,{row:i});let a=[],d=[],c=[];n.forEach(l=>{const n=r(l.domNode.getBoundingClientRect(),o);t?Math.abs(n.y1-e.y1)<5?a.push(l):e.y1-n.y>5&&e.y1-n.y1<-5&&d.push(l):Math.abs(n.y-e.y)<5?a.push(l):e.y-n.y>5&&e.y-n.y1<-5&&d.push(l)});const u=(e,t)=>e.domNode.getBoundingClientRect().x-t.domNode.getBoundingClientRect().x;a.sort(u),a.forEach(e=>{const t=L(),o=e.formats(),l=this.scroll.create(q.blotName,Object.assign({},N,{row:i,colspan:o.colspan})),n=this.scroll.create(x.blotName,{row:i,cell:t,colspan:o.colspan}),r=this.scroll.create(p.blotName);n.appendChild(r),l.appendChild(n),s.appendChild(l),c.push(l)}),d.forEach(e=>{const t=parseInt(e.formats().rowspan,10);e.format("rowspan",t+1),c.push(e)});const h=this.rows().find(l=>{let n=r(l.domNode.getBoundingClientRect(),o);return t?Math.abs(n.y-e.y-e.height)<5:Math.abs(n.y-e.y)<5});return l.insertBefore(s,h),c.sort(u),c}mergeCells(e,t,o,l){const n=t.reduce((e,t,n)=>(0!==n?(e&&t.moveChildren(e),t.remove()):(t.format("colspan",l),t.format("rowspan",o),e=t),e),null);let i=n.domNode.getAttribute("data-row"),r=n.children.head.domNode.getAttribute("data-cell");return n.children.forEach(e=>{e.format("cell",r),e.format("row",i),e.format("colspan",l),e.format("rowspan",o)}),n}unmergeCells(e,t){let o={},l=1,n=1;e.forEach(e=>{if(o=e.formats(),l=o.rowspan,n=o.colspan,n>1){let t=e.next,o=e.row();e.format("colspan",1);for(let e=n;e>1;e--)this.insertCell(o,t)}if(l>1){let o=l,i=e.row().next;for(;o>1;){let l=i.children.reduce((o,l)=>{let n=r(e.domNode.getBoundingClientRect(),t),i=r(l.domNode.getBoundingClientRect(),t);return Math.abs(n.x1-i.x)<5&&(o=l),o},null);for(let e=n;e>0;e--)this.insertCell(i,l);o-=1,i=i.next}e.format("rowspan",1)}})}rows(){const e=this.children.tail;return null==e?[]:e.children.map(e=>e)}}_.blotName="table-container",_.className="quill-table__table",_.tagName="TABLE";class E extends f{constructor(e,t){super(e,t);const o=n.a.find(e.domNode.parentNode);t.addEventListener("scroll",e=>{const t=o.getModule("quill-table");t.columnTool&&(t.columnTool.domNode.scrollLeft=e.target.scrollLeft),t.tableSelection&&t.tableSelection.selectedTds.length>0&&t.tableSelection.repositionHelpLines()},!1)}table(){return this.children.head}}function A(){return"row-"+Math.random().toString(36).slice(2,6)}function L(){return"cell-"+Math.random().toString(36).slice(2,6)}E.blotName="table-view",E.className="quill-table__wrapper",E.tagName="DIV",E.allowedChildren=[_],_.requiredContainer=E,_.allowedChildren=[C,S],C.requiredContainer=_,C.allowedChildren=[v],v.requiredContainer=C,v.allowedChildren=[q],q.requiredContainer=v,q.allowedChildren=[x,h],x.requiredContainer=q,S.allowedChildren=[T],S.requiredContainer=_,T.requiredContainer=S;class O{constructor(e,t){this.quill=e,this.cellNode=t.cellNode,this.init(t)}init({tableNode:e,rowNode:t}){const o=this.quill.root.parentNode;this.domNode=document.createElement("button"),this.domNode.classList.add("quill-table-operation-menu__context-btn"),this.domNode.type="button",this.domNode.addEventListener("click",o=>{const l=this.quill.getModule("quill-table"),n=l.tableSelection;n&&n.selectedTds.length<=1&&n.highlitSelection(this.cellNode),l.showTableOperationMenu(e,t,this.cellNode,o)}),this.calculateButtonPosition(),o.appendChild(this.domNode)}calculateButtonPosition(){const e=this.quill.root.parentNode,t=r(this.cellNode.getBoundingClientRect(),e);i(this.domNode,{top:t.y+"px",left:t.x1+"px"})}destroy(){return this.domNode&&this.domNode.remove(),null}}function I(e,t,o,l){return e.reduce((n,i)=>{let s=r(i.getBoundingClientRect(),l);return o(s,t)&&n.push(e.indexOf(i)),n},[])}function B(e,t){const o={row:null,col:null},l=e.closest&&e.closest("tr"),n=function(e){const t=e.closest&&e.closest("tr");if(!t)return-1;return Array.from(t.children).indexOf(e)}(e);n>-1&&(o.col=n);const i=t.indexOf(l);return i>-1&&(o.row=i),o}const k=["left","right","top","bottom"];class R{constructor({table:e,cell:t,row:o},l,n){if(!e)return null;this.table=e,this.rowNode=o,this.cellNode=t,this.quill=l,this.options=n,this.boundary={},this.selectedTds=[],this.dragging=!1,this.selectingHandler=this.mouseDownHandler.bind(this),this.clearSelectionHandler=this.clearSelection.bind(this),this.helpLinesInitial(),this.quill.root.addEventListener("mousedown",this.selectingHandler,!1),this.quill.root.addEventListener("keydown",()=>this.selectCell(),!1),this.quill.on("text-change",e=>{if(0===this.selectedTds.length)return;const t=this.selectedTds.slice(1);1!==this.selectedTds.length?(this.clearSelectionHandler(),this.applyChangesForSelection(t,e)):this.refreshHelpLinesPosition()}),t&&this.highlitSelection(t)}helpLinesInitial(){let e=this.quill.root.parentNode;k.forEach(t=>{this[t]=document.createElement("div"),this[t].classList.add("quill-table__selection-line"),this[t].classList.add("quill-table__selection-line-"+t),i(this[t],{position:"absolute",display:"none","background-color":"#0589f3"}),e.appendChild(this[t])})}mouseDownHandler(e){if(0!==e.button||!e.target.closest(".quill-table__table"))return;let t=null;this.quill.root.addEventListener("mousemove",a,!1),this.quill.root.addEventListener("mouseup",d,!1),this.quill.root.addEventListener("mouseleave",c,!1);let o;this.table.querySelectorAll(".quill-table__cell-line--selected").forEach(e=>{e.classList.remove("quill-table__cell-line--selected")});const l=this.quill.root.parentNode.querySelectorAll(".quill-table__selection-line");l.forEach(e=>{e.addEventListener("mouseup",d,!1)});const n=this;this.dragging=!0;const{startTd:i,startTdRect:s}=this.highlitSelection(e.target);function a(e){if(0!==e.button||!e.target.closest(".quill-table__table"))return;if(t&&clearTimeout(t),o=e.target.closest("td[data-row]"),!o)return;const l=r(o.getBoundingClientRect(),n.quill.root.parentNode);n.boundary=M(s,l),n.correctBoundary(),n.selectedTds=n.computeSelectedTds(i,o),setTimeout(()=>{n.refreshHelpLinesPosition(),n.showContextMenuButton(o)},0),i!==o&&n.quill.blur()}function d(){t&&clearTimeout(t),n.quill.root.removeEventListener("mousemove",a,!1),n.quill.root.removeEventListener("mouseup",d,!1),n.quill.root.removeEventListener("mouseleave",c,!1),l.forEach(e=>{e.removeEventListener("mouseup",d,!1)}),n.dragging=!1,n.selectCell(),n.showContextMenuButton(o||i)}function c(e){n.dragging&&(function(e){const t=e.relatedTarget&&e.relatedTarget.closest&&e.relatedTarget.closest(".quill-table__wrapper"),o=e.relatedTarget&&e.relatedTarget.classList.contains("quill-table__selection-line"),l=e.relatedTarget&&e.relatedTarget.classList.contains("quill-table-operation-menu__context-btn");return t||o||l}(e)||(t&&clearTimeout(t),t=setTimeout(()=>{d()},1e3)))}}highlitSelection(e){const t=e.closest("td[data-row]"),o=r(t.getBoundingClientRect(),this.quill.root.parentNode);return this.boundary=M(o,o),this.correctBoundary(),this.selectedTds=this.computeSelectedTds(t,t),this.repositionHelpLines(),this.showContextMenuButton(t),{startTd:t,startTdRect:o}}correctBoundary(){n.a.find(this.table).descendants(q).forEach(e=>{let{x:t,y:o,width:l,height:n}=r(e.domNode.getBoundingClientRect(),this.quill.root.parentNode);(t+2>=this.boundary.x&&t+2<=this.boundary.x1||t-2+l>=this.boundary.x&&t-2+l<=this.boundary.x1)&&(o+2>=this.boundary.y&&o+2<=this.boundary.y1||o-2+n>=this.boundary.y&&o-2+n<=this.boundary.y1)&&(this.boundary=M(this.boundary,{x:t,y:o,width:l,height:n}))})}computeSelectedTds(e,t){if("TD"!==e.tagName||"TD"!==t.tagName)return[];const o=Array.from(this.table.querySelectorAll("tr")),l=B(e,o);if(null===l.row||null===l.col)return[];const i=B(t,o);if(null===!i.row||null===i.col)return[];const r=[],{iterationStart:s,iterationEnd:a,beginSelectionIndex:d,endSelectionIndex:c}=(u=l,h=i,{iterationStart:Math.min(u.row,h.row),iterationEnd:Math.max(u.row,h.row),beginSelectionIndex:Math.min(u.col,h.col),endSelectionIndex:Math.max(u.col,h.col)});var u,h;for(let e=s;e<=a;e++){const t=Array.from(o[e].children).slice(d,c+1);r.push(...t.map(e=>n.a.find(e)))}return r}repositionHelpLines(){if(!(this.left&&this.right&&this.top&&this.bottom))return;const e=this.table.parentNode.scrollLeft;i(this.left,{display:"block",left:this.boundary.x-e-1+"px",top:this.boundary.y+"px",height:this.boundary.height+1+"px",width:"1px"}),i(this.right,{display:"block",left:this.boundary.x1-e+"px",top:this.boundary.y+"px",height:this.boundary.height+1+"px",width:"1px"}),i(this.top,{display:"block",left:this.boundary.x-1-e+"px",top:this.boundary.y+"px",width:this.boundary.width+1+"px",height:"1px"}),i(this.bottom,{display:"block",left:this.boundary.x-1-e+"px",top:this.boundary.y1+1+"px",width:this.boundary.width+1+"px",height:"1px"})}refreshHelpLinesPosition(){if(0===this.selectedTds.length)return;const e=r(this.selectedTds[0].domNode.getBoundingClientRect(),this.quill.root.parentNode),t=r(this.selectedTds[this.selectedTds.length-1].domNode.getBoundingClientRect(),this.quill.root.parentNode);this.contextMenuButton&&this.contextMenuButton.calculateButtonPosition(),this.boundary=M(e,t),this.repositionHelpLines()}destroy(){return k.forEach(e=>{this[e].remove(),this[e]=null}),this.quill.root.removeEventListener("mousedown",this.selectingHandler,!1),this.quill.off("text-change",this.clearSelectionHandler),this.hideContextMenuButton(),null}setSelection(e,t){const o=e.getBoundingClientRect(),l=t.getBoundingClientRect();this.boundary=M(r(o,this.quill.root.parentNode),r(l,this.quill.root.parentNode)),this.correctBoundary(),this.selectedTds=this.computeSelectedTds(e,t),setTimeout(()=>{this.refreshHelpLinesPosition(),this.showContextMenuButton(this.selectedTds[this.selectedTds.length-1].domNode)},0)}clearSelection(){this.selectedTds.length>1&&window.getSelection().removeAllRanges(),this.boundary={},this.selectedTds=[],k.forEach(e=>{this[e]&&i(this[e],{display:"none"})}),this.hideContextMenuButton()}selectCell(){if(this.selectedTds.length<=1)return;const e=this.selectedTds[0],t=window.getSelection();t.removeAllRanges();const o=document.createRange();o.setStart(e.domNode,0),o.setEnd(e.domNode,1),t.addRange(o),this.selectedTds.forEach(e=>{e.domNode.classList.add("quill-table__cell-line--selected")})}keyDownButtonHandler(){this.selectCell()}applyChangesForSelection(e,t){const o=t.ops.reduce((e,t)=>t.attributes?(Object.entries(t.attributes).forEach(([t,o])=>{e[t]=o}),e):e,{});e.forEach(e=>{const t=this.quill.getIndex(e);this.quill.formatLine(t,0,o),this.quill.formatText(t,e.domNode.textContent.length,o)}),this.quill.setSelection(null)}showContextMenuButton(e){this.hideContextMenuButton(),this.contextMenuButton=new O(this.quill,{tableNode:this.table,rowNode:this.rowNode,cellNode:e})}hideContextMenuButton(){this.contextMenuButton&&(this.contextMenuButton=this.contextMenuButton.destroy())}}function M(e,t){let o=Math.min(e.x,t.x,e.x+e.width-1,t.x+t.width-1),l=Math.max(e.x,t.x,e.x+e.width-1,t.x+t.width-1),n=Math.min(e.y,t.y,e.y+e.height-1,t.y+t.height-1),i=Math.max(e.y,t.y,e.y+e.height-1,t.y+t.height-1);return{x:o,x1:l,y:n,y1:i,width:l-o,height:i-n}}const D={RU:{table:"Таблица",insert_column_right:"Добавить колонку справа",insert_column_left:"Добавить колонку слева",insert_row_up:"Добавить строку сверху",insert_row_bottom:"Добавить строку снизу",merge_cells:"Объединить ячейки",unmerge_cells:"Разъединить ячейку",delete_columns:"Удалить столбец",delete_rows:"Удалить строку",delete_table:"Удалить таблицу"},EN:{table:"Table",insert_column_right:"Insert column right",insert_column_left:"Insert column left",insert_row_up:"Insert row up",insert_row_bottom:"Insert row down",merge_cells:"Merge selected cells",unmerge_cells:"Unmerge cells",delete_columns:"Delete selected columns",delete_rows:"Delete selected rows",delete_table:"Delete table"}};function H(e,t){const o=t||window.lang||"EN";return(D[o]||D.EN)[e]||D.EN[e]||e}const j=["white","red","yellow","blue"],P={insertColumnRight:{text:H("insert_column_right"),iconClass:"quill-table-operation-menu__icon-add-column-right",handler(){const e=n.a.find(this.table),t=this.selectedTds[this.selectedTds.length-1],o=t.domNode.parentNode.querySelectorAll(".quill-table__cell");let l=Array.from(o).indexOf(t.domNode);const i=e.insertColumn(this.boundary,l,!0,this.quill.root.parentNode);this.quill.update(n.a.sources.SILENT),this.quill.setSelection(this.quill.getIndex(i[0]),0,n.a.sources.SILENT),this.tableSelection.setSelection(i[0].domNode,i[0].domNode),this.tableColumnTool.updateToolCells()}},insertColumnLeft:{text:H("insert_column_left"),iconClass:"quill-table-operation-menu__icon-add-column-left",handler(){const e=n.a.find(this.table),t=this.selectedTds[0],o=t.domNode.parentNode.querySelectorAll(".quill-table__cell");let l=Array.from(o).indexOf(t.domNode);const i=e.insertColumn(this.boundary,l,!1,this.quill.root.parentNode);this.quill.update(n.a.sources.SILENT),this.quill.setSelection(this.quill.getIndex(i[0]),0,n.a.sources.SILENT),this.tableSelection.setSelection(i[0].domNode,i[0].domNode),this.tableColumnTool.updateToolCells()}},insertRowUp:{text:H("insert_row_up"),iconClass:"quill-table-operation-menu__icon-add-column-top",handler(){const e=n.a.find(this.table).insertRow(this.boundary,!1,this.quill.root.parentNode);this.quill.update(n.a.sources.SILENT),this.quill.setSelection(this.quill.getIndex(e[0]),0,n.a.sources.SILENT),this.tableSelection.setSelection(e[0].domNode,e[0].domNode)}},insertRowDown:{text:H("insert_row_bottom"),iconClass:"quill-table-operation-menu__icon-add-column-bottom",handler(){const e=n.a.find(this.table).insertRow(this.boundary,!0,this.quill.root.parentNode);this.quill.update(n.a.sources.SILENT),this.quill.setSelection(this.quill.getIndex(e[0]),0,n.a.sources.SILENT),this.tableSelection.setSelection(e[0].domNode,e[0].domNode)}},mergeCells:{text:H("merge_cells"),iconClass:"quill-table-operation-menu__icon-merge-cells",handler(){const e=n.a.find(this.table),t=e.rows().reduce((e,t)=>{let o=r(t.domNode.getBoundingClientRect(),this.quill.root.parentNode);return o.y>this.boundary.y-5&&o.y+o.height<this.boundary.y+this.boundary.height+5&&(e+=1),e},0),o=this.columnToolCells.reduce((e,t)=>{let o=r(t.getBoundingClientRect(),this.quill.root.parentNode);return o.x>this.boundary.x-5&&o.x+o.width<this.boundary.x+this.boundary.width+5&&(e+=1),e},0),l=e.mergeCells(this.boundary,this.selectedTds,t,o,this.quill.root.parentNode);this.quill.update(n.a.sources.SILENT),this.tableSelection.setSelection(l.domNode,l.domNode)}},unmergeCells:{text:H("unmerge_cells"),iconClass:"quill-table-operation-menu__icon-slpit-cells",handler(){n.a.find(this.table).unmergeCells(this.selectedTds,this.quill.root.parentNode),this.quill.update(n.a.sources.SILENT),this.tableSelection.clearSelection()}},deleteColumn:{text:H("delete_columns"),iconClass:"quill-table-operation-menu__icon-remove-column",handler(){const e=n.a.find(this.table);let t=I(this.columnToolCells,this.boundary,(e,t)=>e.x+5>t.x&&e.x+e.width-5<t.x1,this.quill.root.parentNode);e.deleteColumns(this.boundary,t,this.quill.root.parentNode)||(this.quill.update(n.a.sources.SILENT),this.tableSelection.clearSelection(),this.tableColumnTool.updateToolCells())}},deleteRow:{text:H("delete_rows"),iconClass:"quill-table-operation-menu__icon-remove-row",handler(){n.a.find(this.table).deleteRow(this.boundary,this.quill.root.parentNode),this.quill.update(n.a.sources.SILENT),this.tableSelection.clearSelection()}},deleteTable:{text:H("delete_table"),iconClass:"quill-table-operation-menu__icon-delete-table",handler(){const e=this.quill.getModule("quill-table"),t=n.a.find(this.table);e.hideTableTools(),t.remove(),this.quill.update(n.a.sources.SILENT)}}};class U{constructor(e,t,o={}){const l=t.getModule("quill-table");this.tableSelection=l.tableSelection,this.table=e.table,this.quill=t,this.options=o,this.menuItems=Object.assign({},P,o.items||{}),this.tableColumnTool=l.columnTool,this.boundary=this.tableSelection.boundary,this.selectedTds=this.tableSelection.selectedTds,this.destroyHandler=this.destroy.bind(this),this.columnToolCells=this.tableColumnTool.colToolCells(),this.colorSubTitle=o.color&&o.color.text?o.color.text:"Background Colors",this.cellColors=o.color&&o.color.colors?o.color.colors:j,this.evt=e.evt,this.menuInitial(e),this.mount(),document.addEventListener("click",this.destroyHandler,!1)}mount(){document.body.appendChild(this.domNode);const{left:e,top:t}=this.calculatePosition();i(this.domNode,{left:e+"px",top:t+"px"})}destroy(){return this.domNode.remove(),document.removeEventListener("click",this.destroyHandler,!1),null}menuInitial(){this.domNode=document.createElement("div"),this.domNode.classList.add("quill-table-operation-menu"),i(this.domNode,{position:"absolute","min-height":"150px","max-width":"min(-10px + 100vw, 300px);"});for(let t in this.menuItems)this.menuItems[t]&&(this.domNode.appendChild(this.menuItemCreator(Object.assign({},P[t],this.menuItems[t]))),["insertRowDown","unmergeCells"].indexOf(t)>-1&&this.domNode.appendChild(e()));function e(){const e=document.createElement("div");return e.classList.add("quill-table-operation-menu__divider"),e}this.options.color&&!1!==this.options.color&&(this.domNode.appendChild(e()),this.domNode.appendChild(function(e){const t=document.createElement("div");return t.classList.add("quill-table-operation-menu__subtitle"),t.innerText=e,t}(this.colorSubTitle)),this.domNode.appendChild(this.colorsItemCreator(this.cellColors)))}colorsItemCreator(e){const t=this,o=document.createElement("div");return o.classList.add("quill-table-color-picker"),e.forEach(e=>{let l=function(e){const o=document.createElement("div");return o.classList.add("quill-table-color-picker__item"),o.setAttribute("data-color",e),o.style.backgroundColor=e,o.addEventListener("click",(function(){const o=t.tableSelection.selectedTds;o&&o.length>0&&o.forEach(t=>{t.format("cell-bg",e)})}),!1),o}(e);o.appendChild(l)}),o}menuItemCreator({text:e,iconClass:t,handler:o}){const l=document.createElement("div");l.classList.add("quill-table-operation-menu__item");const n=document.createElement("span");n.classList.add("quill-table-operation-menu__icon"),n.classList.add(t);const i=document.createElement("span");return i.classList.add("quill-table-operation-menu__text"),i.innerText=e,l.appendChild(n),l.appendChild(i),l.addEventListener("click",o.bind(this),!1),l}calculatePosition(){const e=parseInt(this.evt.clientX,10)||0,t=parseInt(this.evt.clientY,10)||0,{clientWidth:o,clientHeight:l}=document.documentElement,{offsetWidth:n,offsetHeight:i}=this.domNode;let r=e+5;e+n>o-5&&(r=e-n-5,r<5&&(r=5));let s=this.evt.pageY;return t+i>l&&(s=this.evt.pageY-i,s<150&&(s=150)),{top:s,left:r}}}const W=n.a.import("delta");function z(e,t){const o=e.parentNode,l="TABLE"===o.parentNode.tagName?o.parentNode:o.parentNode.parentNode,n=Array.from(l.querySelectorAll("tr")),i=Array.from(o.querySelectorAll("td")),r=n.indexOf(o)+1,a=i.indexOf(e)+1,d=e.getAttribute("colspan")||!1,c=e.getAttribute("rowspan")||!1,u=e.getAttribute("data-cell-bg")||e.style.backgroundColor;return 0===t.length()?t=(new W).insert("\n",{"table-cell-line":{row:r,cell:a,rowspan:c,colspan:d}}):(t=t.reduce((e,t)=>{if(t.insert&&"string"==typeof t.insert){const o=[];let l=t.insert,n=0;for(let e=0;e<t.insert.length;e++)"\n"===l.charAt(e)&&(0===e||o.push(l.substring(n,e)),o.push("\n"),n=e+1);const i=l.substring(n);i&&o.push(i),o.forEach(o=>{"\n"===o?e.insert("\n",t.attributes):e.insert(o,s(t.attributes,["table","table-cell-line"]))})}else e.insert(t.insert,t.attributes);return e},new W)).reduce((e,t)=>t.insert&&"string"==typeof t.insert&&t.insert.startsWith("\n")?(e.insert(t.insert,Object.assign({},Object.assign({},{row:r},t.attributes.table),{"table-cell-line":{row:r,cell:a,rowspan:c,colspan:d,"cell-bg":u}},s(t.attributes,["table"]))),e):(t.attributes&&t.attributes.background&&t.attributes.background===function(e){if(/^(rgb|RGB)/.test(e)){const t=e.toString().match(/\d+/g);let o="#";for(let e=0;e<3;e++)o+=("0"+Number(t[e]).toString(16)).slice(-2);return o}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){const t=e.replace(/#/,"").split("");if(6===t.length)return e;if(3===t.length){let e="#";for(let o=0;o<t.length;o+=1)e+=t[o]+t[o];return e}}return e}(u)?e.insert(t.insert,Object.assign({},s(t.attributes,["table","table-cell-line","background"]))):e.insert(t.insert,Object.assign({},s(t.attributes,["table","table-cell-line"]))),e),new W)}function F(e,t){const o=e.parentNode,l="TABLE"===o.parentNode.tagName?o.parentNode:o.parentNode.parentNode,n=Array.from(l.querySelectorAll("tr")),i=Array.from(o.querySelectorAll("th")),r=n.indexOf(o)+1,a=i.indexOf(e)+1,d=e.getAttribute("colspan")||!1,c=e.getAttribute("rowspan")||!1;return 0===t.length()?t=(new W).insert("\n",{"table-cell-line":{row:r,cell:a,rowspan:c,colspan:d}}):(t=t.reduce((e,t)=>{if(t.insert&&"string"==typeof t.insert){const o=[];let l=t.insert,n=0;for(let e=0;e<t.insert.length;e++)"\n"===l.charAt(e)&&(0===e||o.push(l.substring(n,e)),o.push("\n"),n=e+1);const i=l.substring(n);i&&o.push(i),o.indexOf("\n")<0&&o.push("\n"),o.forEach(o=>{"\n"===o?e.insert("\n",{"table-cell-line":{row:r,cell:a,rowspan:c,colspan:d}}):e.insert(o,t.attributes)})}else e.insert(t.insert,t.attributes);return e},new W)).reduce((e,t)=>(t.insert&&"string"==typeof t.insert&&t.insert.startsWith("\n")?e.insert(t.insert,Object.assign({},{"table-cell-line":{row:r,cell:a,rowspan:c,colspan:d}})):e.insert(t.insert,Object.assign({},s(t.attributes,["table","table-cell-line"]))),e),new W)}function X(e,t){let o=new W;const l=e.querySelector("tr");if(null===l)return o;const n=Array.from(l.querySelectorAll("td")).concat(Array.from(l.querySelectorAll("th"))).reduce((e,t)=>{const o=t.getAttribute("colspan")||1;return e+=parseInt(o,10)},0),i=e.querySelectorAll("col").length;if(i===n)return t;{for(let e=0;e<n-i;e++)o.insert("\n",{"table-col":!0});if(0===i)return o.concat(t);let e=0;return t.reduce((t,l)=>(t.insert(l.insert,l.attributes),l.attributes&&l.attributes["table-col"]&&(e+=l.insert.length,e===i&&(t=t.concat(o))),t),new W)}}const G=n.a.import("core/module"),K=n.a.import("delta");class Y extends G{static register(){n.a.register(T,!0),n.a.register(S,!0),n.a.register(x,!0),n.a.register(q,!0),n.a.register(v,!0),n.a.register(C,!0),n.a.register(_,!0),n.a.register(E,!0)}constructor(e,t){super(e,t),this.quill.root.addEventListener("click",o=>{const l=a(o);if(!l||l.length<=0)return;const{tableNode:n,rowNode:i,cellNode:r}=l.reduce((e,t)=>{if(!t.tagName)return e;const l=t.tagName.toUpperCase();if("TABLE"===l&&t.classList.contains("quill-table__table"))return e.tableNode=t,e;if("TR"===l&&(e.rowNode=t),("TBODY"===l||e.rowNode)&&!e.cellNode){const t=document.elementFromPoint(o.x,o.y);t&&(e.cellNode=t.closest(".quill-table__cell"))}return t.classList.contains("quill-table__cell")&&(e.cellNode=t),e},{cellNode:null,rowNode:null,tableNode:null});if(n){if(this.table===n)return;this.table&&this.hideTableTools(),this.showTableTools(n,i,r,e,t)}else this.table&&this.hideTableTools()},!1),this.quill.root.addEventListener("contextmenu",e=>{if(!this.table)return!0;e.preventDefault();const t=a(e);if(!t||t.length<=0)return;const o=t.filter(e=>e.tagName&&"TABLE"===e.tagName.toUpperCase()&&e.classList.contains("quill-table__table"))[0],l=t.filter(e=>e.tagName&&"TR"===e.tagName.toUpperCase()&&e.getAttribute("data-row"))[0],n=t.filter(e=>e.tagName&&"TD"===e.tagName.toUpperCase()&&e.getAttribute("data-row"))[0];let i=this.tableSelection.selectedTds.map(e=>e.domNode).includes(n);(this.tableSelection.selectedTds.length<=0||!i)&&this.tableSelection.setSelection(n,n),this.showTableOperationMenu(o,l,n,e)},!1),e.keyboard.addBinding({key:"Backspace"},{},(e,t)=>this.tableDeletionProtection(e,t)),e.keyboard.addBinding({key:"Backspace",shiftKey:!0},{},(e,t)=>this.tableDeletionProtection(e,t));let o=e.keyboard.bindings.Backspace.slice(e.keyboard.bindings.Backspace.length-2,e.keyboard.bindings.Backspace.length);e.keyboard.bindings.Backspace.splice(0,2,...o),e.keyboard.bindings.Backspace.splice(e.keyboard.bindings.Backspace.length-2,2);const l=e.keyboard.bindings.Tab[e.keyboard.bindings.Tab.length-1];e.keyboard.bindings.Tab.splice(0,1,l),e.clipboard.addMatcher("td",z),e.clipboard.addMatcher("th",F),e.clipboard.addMatcher("table",X),e.clipboard.matchers=e.clipboard.matchers.filter(e=>"tr"!==e[0]),this.quill.on("selection-change",e=>{this.correctSelection(e)}),window.addEventListener("resize",()=>{this.columnTool&&(this.columnTool.updateToolCells(),this.columnTool.updateToolWidth()),this.tableSelection&&this.tableSelection.refreshHelpLinesPosition()},!1)}getTable(e=this.quill.getSelection()){if(null==e)return[null,null,null,-1];const[t,o]=this.quill.getLine(e.index);if(null==t||t.statics.blotName!==x.blotName)return[null,null,null,-1];const l=t.tableCell(),n=l.row();return[n.table(),n,l,o]}insertTable(e,t){const o=this.quill.getSelection(!0);if(null==o)return;let l=this.quill.getLeaf(o.index)[0];if(i=l,Boolean(i.domNode.closest&&i.domNode.closest("table")))return void console.warn("Can not insert table into a table cell.");var i;let r=(new K).retain(o.index);r.insert("\n"),r=new Array(t).fill("\n").reduce((e,t)=>(e.insert(t,{"table-col":!0}),e),r),r=new Array(e).fill(0).reduce(e=>{let o=A();return new Array(t).fill("\n").reduce((e,t)=>(e.insert(t,{"table-cell-line":{row:o,cell:L()}}),e),e)},r),this.quill.updateContents(r,n.a.sources.USER);const s=o.index+t+1;this.quill.setSelection(s,n.a.sources.API);const[a]=this.quill.getLine(s);if(!J(a))return;const d=a.parent;if(!d)return;const c=d.parent;if(!c)return;const u=c.domNode.closest("table");u&&this.showTableTools(u,c.domNode,d.domNode,this.quill,this.options)}tableInsertColumn(e){const t=n.a.find(this.table),o=this.tableSelection,l=this.columnTool;let i=function(e,t,o,l){return e.reduce((n,i)=>{let s=r(i.getBoundingClientRect(),l);return o(s,t)&&(n=e.indexOf(i)),n},!1)}(l.colToolCells(),o.boundary,(e,t)=>Math.abs(e.x+e.width-t.x1)<=5,o.quill.root.parentNode);const s=t.insertColumn(o.boundary,i,"right"===e,o.quill.root.parentNode);l.updateToolCells(),o.quill.update(n.a.sources.USER),o.quill.setSelection(o.quill.getIndex(s[0]),0,n.a.sources.SILENT),o.setSelection(s[0].domNode,s[0].domNode)}insertColumnLeft(){this.tableInsertColumn("left")}insertColumnRight(){this.tableInsertColumn("right")}tableInsertRow(e){const t=n.a.find(this.table),o=this.tableSelection,l=t.insertRow(o.boundary,"below"===e,o.quill.root.parentNode);o.quill.update(n.a.sources.USER),o.quill.setSelection(o.quill.getIndex(l[0]),0,n.a.sources.SILENT),o.setSelection(l[0].domNode,l[0].domNode)}insertRowAbove(){this.tableInsertRow("above")}insertRowBelow(){this.tableInsertRow("below")}deleteRow(){const e=n.a.find(this.table),t=this.tableSelection;e.deleteRow(t.boundary,t.quill.root.parentNode),t.quill.update(n.a.sources.USER),t.clearSelection()}deleteColumn(){const e=n.a.find(this.table),t=this.tableSelection,o=this.columnTool;let l=I(o.colToolCells(),t.boundary,(e,t)=>e.x+5>t.x&&e.x+e.width-5<t.x1,t.quill.root.parentNode);e.deleteColumns(t.boundary,l,t.quill.root.parentNode)||(o.updateToolCells(),t.quill.update(n.a.sources.USER),t.clearSelection())}deleteTable(){n.a.find(this.table).tableDestroy()}showTableTools(e,t,o,l,n){this.table=e,this.columnTool=new d(e,l,n),this.tableSelection=new R({table:e,row:t,cell:o},l,n)}hideTableTools(){this.columnTool&&this.columnTool.destroy(),this.tableSelection&&this.tableSelection.destroy(),this.tableOperationMenu&&this.tableOperationMenu.destroy(),this.columnTool=null,this.tableSelection=null,this.tableOperationMenu=null,this.table=null}showTableOperationMenu(e,t,o,l){this.tableOperationMenu&&(this.tableOperationMenu=this.tableOperationMenu.destroy()),e&&setTimeout(()=>{this.tableOperationMenu=new U({table:e,row:t,cell:o,evt:l},this.quill,this.options.operationMenu)},0)}tableDeletionProtection(e,t){if(0===e.index||this.quill.getLength()<=1)return!0;const[o]=this.quill.getLine(e.index);if(t.event.shiftKey&&J(o))return!1;if(this.tableSelection&&this.tableSelection.selectedTds&&this.tableSelection.selectedTds.length>1)return!1;if(0===t.offset){const[t]=this.quill.getLine(e.index-1);if(null!=t&&J(t)&&!J(o))return!1}return!0}correctSelection(e){if(!e)return;const t=this.quill.getLines(e);if(0===t.length){const[t]=this.quill.getLine(e.index);if(!J(t))return;return void(this.tableSelection?this.tableSelection.selectedTds&&1===this.tableSelection.selectedTds.length&&this.tableSelection.setSelection(t.parent.domNode,t.parent.domNode):this.showTableTools(this.table,t.domNode.closest("tr"),t.parent.domNode,this.quill,this.options))}const o=t.filter(e=>J(e)),l=o.length;if(0===l)return;const n=o[0],i=this.quill.getIndex(n),r=n.domNode.textContent.length;if(1===t.length&&1===l)return 0===r?void this.quill.setSelection(i):void(!n.parent.next&&e.length>=r&&this.quill.setSelection(i,r));const s=t.reduce((e,t)=>e+t.domNode.textContent.length,0);this.quill.setSelection(i,s+l-1)}}function $(e,t=!1){return{key:e?"ArrowUp":"ArrowDown",collapsed:!0,shiftKey:t,format:["table-cell-line"],handler(t,o){const l=e?"prev":"next";if(null!=o.line[l])return!0;const i=o.line.parent,r=i.parent[l];if(null!=r&&"table-row"===r.statics.blotName){let e=r.children.head,t=parseInt(e.formats().colspan,10),o=i,l=parseInt(o.formats().colspan,10);for(;null!=o.prev;)o=o.prev,l+=parseInt(o.formats().colspan,10);for(;null!=e.next&&t<l;)e=e.next,t+=parseInt(e.formats().colspan,10);const s=e.offset(this.quill.scroll);this.quill.setSelection(s,0,n.a.sources.USER)}else{const t=i.table().parent[l];null!=t&&(e?this.quill.setSelection(t.offset(this.quill.scroll)+t.length()-1,0,n.a.sources.USER):this.quill.setSelection(t.offset(this.quill.scroll),0,n.a.sources.USER))}return!1}}}function J(e){return"table-cell-line"===e.statics.blotName}Y.keyboardBindings={"table-cell-line backspace":{key:"Backspace",format:["table-cell-line"],collapsed:!0,offset:0,handler(e){const[t]=this.quill.getLine(e.index);return!(!t.prev||!J(t.prev))}},"table-cell-line delete":{key:"Delete",format:["table-cell-line"],collapsed:!0,suffix:/^$/,handler(){}},"table-cell-line enter":{key:"Enter",shiftKey:null,format:["table-cell-line"],handler(e,t){if(this.quill.selection&&this.quill.selection.composing)return;const o=n.a.imports.parchment.Scope;e.length>0&&this.quill.scroll.deleteAt(e.index,e.length);const l=Object.keys(t.format).reduce((e,l)=>(this.quill.scroll.query(l,o.BLOCK)&&!Array.isArray(t.format[l])&&(e[l]=t.format[l]),e),{});this.quill.insertText(e.index,"\n",l["table-cell-line"],n.a.sources.USER),this.quill.setSelection(e.index+1,n.a.sources.SILENT),this.quill.focus(),Object.keys(t.format).forEach(e=>{null==l[e]&&(Array.isArray(t.format[e])||"link"!==e&&this.quill.format(e,t.format[e],n.a.sources.USER))})}},"table-cell-line up":$(!0),"table-cell-line down":$(!1),"table-cell-line up shift":$(!0,!0),"table-cell-line down shift":$(!1,!0),"down-to-table":{key:"ArrowDown",collapsed:!0,handler(e,t){const o=t.line.next;if(o&&"table-view"===o.statics.blotName){const e=o.table().rows()[0].children.head.children.head;return this.quill.setSelection(e.offset(this.quill.scroll),0,n.a.sources.USER),!1}return!0}},"up-to-table":{key:"ArrowUp",collapsed:!0,handler(e,t){const o=t.line.prev;if(o&&"table-view"===o.statics.blotName){const e=o.table().rows(),t=e[e.length-1].children.head.children.head;return this.quill.setSelection(t.offset(this.quill.scroll),0,n.a.sources.USER),!1}return!0}},"table-cell-line tab":{key:"Tab",format:["table-cell-line"],handler(e,t){if(!J(t.line))return!0;const o=t.line.parent;if(o.next){const e=this.quill.getIndex(t.line.parent.next);return this.quill.setSelection(e,n.a.sources.USER),!1}if(o.parent.next&&o.parent.next.children.length>0){const e=this.quill.getIndex(o.parent.next.children.head);return this.quill.setSelection(e,n.a.sources.USER),!1}return!1}}},Y.requiredTableFormats=["table","table-cell-line","table-row","table-body","table-col","table-col-group","table-container","table-view"];t.default=Y}]).default}));