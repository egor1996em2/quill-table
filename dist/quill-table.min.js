!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("quill")):"function"==typeof define&&define.amd?define(["quill"],t):"object"==typeof exports?exports.quillTable=t(require("quill")):e.quillTable=t(e.Quill)}(window,(function(e){return function(e){var t=window.webpackHotUpdatequillTable;window.webpackHotUpdatequillTable=function(e,l){!function(e,t){if(!x[e]||!N[e])return;for(var l in N[e]=!1,t)Object.prototype.hasOwnProperty.call(t,l)&&(b[l]=t[l]);0==--g&&0===y&&T()}(e,l),t&&t(e,l)};var l,o=!0,n="10d59680b76f2baf1899",i={},r=[],s=[];function a(e){var t=A[e];if(!t)return L;var o=function(o){return t.hot.active?(A[o]?-1===A[o].parents.indexOf(e)&&A[o].parents.push(e):(r=[e],l=o),-1===t.children.indexOf(o)&&t.children.push(o)):(console.warn("[HMR] unexpected require("+o+") from disposed module "+e),r=[]),L(o)},n=function(e){return{configurable:!0,enumerable:!0,get:function(){return L[e]},set:function(t){L[e]=t}}};for(var i in L)Object.prototype.hasOwnProperty.call(L,i)&&"e"!==i&&"t"!==i&&Object.defineProperty(o,i,n(i));return o.e=function(e){return"ready"===u&&h("prepare"),y++,L.e(e).then(t,(function(e){throw t(),e}));function t(){y--,"prepare"===u&&(w[e]||C(e),0===y&&0===g&&T())}},o.t=function(e,t){return 1&t&&(e=o(e)),L.t(e,-2&t)},o}function d(t){var o={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_selfInvalidated:!1,_disposeHandlers:[],_main:l!==t,active:!0,accept:function(e,t){if(void 0===e)o._selfAccepted=!0;else if("function"==typeof e)o._selfAccepted=e;else if("object"==typeof e)for(var l=0;l<e.length;l++)o._acceptedDependencies[e[l]]=t||function(){};else o._acceptedDependencies[e]=t||function(){}},decline:function(e){if(void 0===e)o._selfDeclined=!0;else if("object"==typeof e)for(var t=0;t<e.length;t++)o._declinedDependencies[e[t]]=!0;else o._declinedDependencies[e]=!0},dispose:function(e){o._disposeHandlers.push(e)},addDisposeHandler:function(e){o._disposeHandlers.push(e)},removeDisposeHandler:function(e){var t=o._disposeHandlers.indexOf(e);t>=0&&o._disposeHandlers.splice(t,1)},invalidate:function(){switch(this._selfInvalidated=!0,u){case"idle":(b={})[t]=e[t],h("ready");break;case"ready":E(t);break;case"prepare":case"check":case"dispose":case"apply":(m=m||[]).push(t)}},check:v,apply:S,status:function(e){if(!e)return u;c.push(e)},addStatusHandler:function(e){c.push(e)},removeStatusHandler:function(e){var t=c.indexOf(e);t>=0&&c.splice(t,1)},data:i[t]};return l=void 0,o}var c=[],u="idle";function h(e){u=e;for(var t=0;t<c.length;t++)c[t].call(null,e)}var p,b,f,m,g=0,y=0,w={},N={},x={};function q(e){return+e+""===e?+e:e}function v(e){if("idle"!==u)throw new Error("check() is only allowed in idle status");return o=e,h("check"),(t=1e4,t=t||1e4,new Promise((function(e,l){if("undefined"==typeof XMLHttpRequest)return l(new Error("No browser support"));try{var o=new XMLHttpRequest,i=L.p+""+n+".hot-update.json";o.open("GET",i,!0),o.timeout=t,o.send(null)}catch(e){return l(e)}o.onreadystatechange=function(){if(4===o.readyState)if(0===o.status)l(new Error("Manifest request to "+i+" timed out."));else if(404===o.status)e();else if(200!==o.status&&304!==o.status)l(new Error("Manifest request to "+i+" failed."));else{try{var t=JSON.parse(o.responseText)}catch(e){return void l(e)}e(t)}}}))).then((function(e){if(!e)return h(_()?"ready":"idle"),null;N={},w={},x=e.c,f=e.h,h("prepare");var t=new Promise((function(e,t){p={resolve:e,reject:t}}));b={};return C(0),"prepare"===u&&0===y&&0===g&&T(),t}));var t}function C(e){x[e]?(N[e]=!0,g++,function(e){var t=document.createElement("script");t.charset="utf-8",t.src=L.p+""+e+"."+n+".hot-update.js",document.head.appendChild(t)}(e)):w[e]=!0}function T(){h("ready");var e=p;if(p=null,e)if(o)Promise.resolve().then((function(){return S(o)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var l in b)Object.prototype.hasOwnProperty.call(b,l)&&t.push(q(l));e.resolve(t)}}function S(t){if("ready"!==u)throw new Error("apply() is only allowed in ready status");return function t(o){var s,a,d,c,u;function p(e){for(var t=[e],l={},o=t.map((function(e){return{chain:[e],id:e}}));o.length>0;){var n=o.pop(),i=n.id,r=n.chain;if((c=A[i])&&(!c.hot._selfAccepted||c.hot._selfInvalidated)){if(c.hot._selfDeclined)return{type:"self-declined",chain:r,moduleId:i};if(c.hot._main)return{type:"unaccepted",chain:r,moduleId:i};for(var s=0;s<c.parents.length;s++){var a=c.parents[s],d=A[a];if(d){if(d.hot._declinedDependencies[i])return{type:"declined",chain:r.concat([a]),moduleId:i,parentId:a};-1===t.indexOf(a)&&(d.hot._acceptedDependencies[i]?(l[a]||(l[a]=[]),g(l[a],[i])):(delete l[a],t.push(a),o.push({chain:r.concat([a]),id:a})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:l}}function g(e,t){for(var l=0;l<t.length;l++){var o=t[l];-1===e.indexOf(o)&&e.push(o)}}_();var y={},w=[],N={},v=function(){console.warn("[HMR] unexpected require("+T.moduleId+") to disposed module")};for(var C in b)if(Object.prototype.hasOwnProperty.call(b,C)){var T;u=q(C),T=b[C]?p(u):{type:"disposed",moduleId:C};var S=!1,E=!1,O=!1,I="";switch(T.chain&&(I="\nUpdate propagation: "+T.chain.join(" -> ")),T.type){case"self-declined":o.onDeclined&&o.onDeclined(T),o.ignoreDeclined||(S=new Error("Aborted because of self decline: "+T.moduleId+I));break;case"declined":o.onDeclined&&o.onDeclined(T),o.ignoreDeclined||(S=new Error("Aborted because of declined dependency: "+T.moduleId+" in "+T.parentId+I));break;case"unaccepted":o.onUnaccepted&&o.onUnaccepted(T),o.ignoreUnaccepted||(S=new Error("Aborted because "+u+" is not accepted"+I));break;case"accepted":o.onAccepted&&o.onAccepted(T),E=!0;break;case"disposed":o.onDisposed&&o.onDisposed(T),O=!0;break;default:throw new Error("Unexception type "+T.type)}if(S)return h("abort"),Promise.reject(S);if(E)for(u in N[u]=b[u],g(w,T.outdatedModules),T.outdatedDependencies)Object.prototype.hasOwnProperty.call(T.outdatedDependencies,u)&&(y[u]||(y[u]=[]),g(y[u],T.outdatedDependencies[u]));O&&(g(w,[T.moduleId]),N[u]=v)}var k,R=[];for(a=0;a<w.length;a++)u=w[a],A[u]&&A[u].hot._selfAccepted&&N[u]!==v&&!A[u].hot._selfInvalidated&&R.push({module:u,parents:A[u].parents.slice(),errorHandler:A[u].hot._selfAccepted});h("dispose"),Object.keys(x).forEach((function(e){!1===x[e]&&function(e){delete installedChunks[e]}(e)}));var B,M,D=w.slice();for(;D.length>0;)if(u=D.pop(),c=A[u]){var H={},j=c.hot._disposeHandlers;for(d=0;d<j.length;d++)(s=j[d])(H);for(i[u]=H,c.hot.active=!1,delete A[u],delete y[u],d=0;d<c.children.length;d++){var P=A[c.children[d]];P&&((k=P.parents.indexOf(u))>=0&&P.parents.splice(k,1))}}for(u in y)if(Object.prototype.hasOwnProperty.call(y,u)&&(c=A[u]))for(M=y[u],d=0;d<M.length;d++)B=M[d],(k=c.children.indexOf(B))>=0&&c.children.splice(k,1);h("apply"),void 0!==f&&(n=f,f=void 0);for(u in b=void 0,N)Object.prototype.hasOwnProperty.call(N,u)&&(e[u]=N[u]);var U=null;for(u in y)if(Object.prototype.hasOwnProperty.call(y,u)&&(c=A[u])){M=y[u];var W=[];for(a=0;a<M.length;a++)if(B=M[a],s=c.hot._acceptedDependencies[B]){if(-1!==W.indexOf(s))continue;W.push(s)}for(a=0;a<W.length;a++){s=W[a];try{s(M)}catch(e){o.onErrored&&o.onErrored({type:"accept-errored",moduleId:u,dependencyId:M[a],error:e}),o.ignoreErrored||U||(U=e)}}}for(a=0;a<R.length;a++){var z=R[a];u=z.module,r=z.parents,l=u;try{L(u)}catch(e){if("function"==typeof z.errorHandler)try{z.errorHandler(e)}catch(t){o.onErrored&&o.onErrored({type:"self-accept-error-handler-errored",moduleId:u,error:t,originalError:e}),o.ignoreErrored||U||(U=t),U||(U=e)}else o.onErrored&&o.onErrored({type:"self-accept-errored",moduleId:u,error:e}),o.ignoreErrored||U||(U=e)}}if(U)return h("fail"),Promise.reject(U);if(m)return t(o).then((function(e){return w.forEach((function(t){e.indexOf(t)<0&&e.push(t)})),e}));return h("idle"),new Promise((function(e){e(w)}))}(t=t||{})}function _(){if(m)return b||(b={}),m.forEach(E),m=void 0,!0}function E(t){Object.prototype.hasOwnProperty.call(b,t)||(b[t]=e[t])}var A={};function L(t){if(A[t])return A[t].exports;var l=A[t]={i:t,l:!1,exports:{},hot:d(t),parents:(s=r,r=[],s),children:[]};return e[t].call(l.exports,l,l.exports,a(t)),l.l=!0,l.exports}return L.m=e,L.c=A,L.d=function(e,t,l){L.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},L.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},L.t=function(e,t){if(1&t&&(e=L(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(L.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)L.d(l,o,function(t){return e[t]}.bind(null,o));return l},L.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return L.d(t,"a",t),t},L.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},L.p="",L.h=function(){return n},a(1)(L.s=1)}([function(t,l){t.exports=e},function(e,t,l){e.exports=l(2)},function(e,t,l){"use strict";l.r(t);var o=l(0),n=l.n(o);function i(e,t){if("object"==typeof t)for(let l in t)e.style[l]=t[l]}function r(e,t){let l=t.getBoundingClientRect();return{x:e.x-l.x-t.scrollLeft,y:e.y-l.y-t.scrollTop,x1:e.x-l.x-t.scrollLeft+e.width,y1:e.y-l.y-t.scrollTop+e.height,width:e.width,height:e.height}}function s(e,t){return e&&Object.keys(e).reduce((l,o)=>t.includes(o)?l:Object.assign({},l,{[o]:e[o]}),{})}function a(e){let t;if(t=e.path||e.composedPath&&e.composedPath(),void 0===t&&e.target){t=[];let l=e.target;for(t.push(l);l&&l.parentNode;)l=l.parentNode,t.push(l)}return t}class d{constructor(e,t,l){if(!e)return null;this.table=e,this.quill=t,this.options=l,this.domNode=null,this.isTouchDevice=this.checkTouchDevice(),this.initColTool()}initColTool(){const e=this.quill.root.parentNode;this.domNode=document.createElement("div"),this.domNode.classList.add("quill-table-col-tool"),this.updateToolCells(),e.appendChild(this.domNode),this.updateToolWidth()}createToolCell(e=!0){const t=document.createElement("div");t.classList.add("quill-table-col-tool__cell");const l=document.createElement("div");return e&&this.setCellResizeHolderClass(l),i(t,{height:"12px"}),t.appendChild(l),t}setCellResizeHolderClass(e){e.classList.add("quill-table-col-tool__cell-holder")}updateToolWidth(){const e=this.table.parentNode.getBoundingClientRect(),t=this.quill.root.parentNode;i(this.domNode,{width:e.width+"px",height:"12px",left:this.table.offsetLeft+t.scrollLeft+"px",top:this.table.offsetTop+t.scrollTop-12+2+"px"})}updateToolCells(){return new Promise(e=>{setTimeout(()=>{const t=n.a.find(this.table),l=t.children.tail.children.head.children,o=t.colGroup().children,r=t.children.tail.domNode.clientWidth,s=function(e){return e.reduce((e,t)=>{const l=t.formats().colspan;return e+=parseInt(l,10)},0)}(l);let a=Array.from(this.domNode.querySelectorAll(".quill-table-col-tool__cell"));const d=Math.max(s,a.length);for(let e=0;e<d;e++){let t=o.at(e),l=t&&t.attributes.domNode.clientWidth,n=null;if(a[e])if(a[e]&&e>=s)a[e].remove();else{n=a[e];i(n,{width:l/r*100+"%"});const t=e+1;if(t===a.length&&t<d){const e=n.querySelector("div");if(!e)continue;this.setCellResizeHolderClass(e),this.addColCellHolderHandler(n)}}else{n=this.createToolCell(e+1!==d),this.domNode.appendChild(n),this.addColCellHolderHandler(n);i(n,{width:l/r*100+"%"})}}e()},0)})}destroy(){return this.domNode.remove(),null}addColCellHolderHandler(e){const t=n.a.find(this.table),l=e.querySelector(".quill-table-col-tool__cell-holder");let o=!1,r=0,s=0,a=0,d=0,c={},u={},h=null;const p=e=>{e.preventDefault(),o&&(s=this.getClientXFromEvent(e),a=d+s-r>=50?s-r:50-d,i(h,{left:u.left+u.width-1+a+"px"}))},b=n=>{n.preventDefault();const i=Array.from(this.domNode.querySelectorAll(".quill-table-col-tool__cell")).indexOf(e),f=t.colGroup().children.at(i),m=f.next,g=m.domNode.clientWidth;o&&(f.format("width",d+a),m.format("width",g-a),r=0,s=0,a=0,d=0,o=!1,l.classList.remove("dragging")),document.removeEventListener("mousemove",p,!1),document.removeEventListener("mouseup",b,!1),this.isTouchDevice&&(document.removeEventListener("touchmove",p,!1),document.removeEventListener("touchend",b,!1)),c={},u={},h.remove(),h=null,t.updateTableWidth();const y=this.quill.getModule("quill-table").tableSelection;y&&y.clearSelection(),this.updateToolCells()},f=t=>{document.addEventListener("mousemove",p,!1),document.addEventListener("mouseup",b,!1),this.isTouchDevice&&(document.addEventListener("touchmove",p,!1),document.addEventListener("touchend",b,!1)),c=this.table.getBoundingClientRect(),u=e.getBoundingClientRect(),h=document.createElement("div"),i(h,{position:"fixed",top:u.top+"px",left:u.left+u.width-1+"px",zIndex:"100",height:c.height+12+4+"px",width:"1px",backgroundColor:"#35A7ED"}),document.body.appendChild(h),o=!0,r=this.getClientXFromEvent(t),d=u.width,l.classList.add("dragging")};null!==l&&(l.addEventListener("mousedown",f,!1),this.isTouchDevice&&l.addEventListener("touchstart",f,!1))}colToolCells(){return Array.from(this.domNode.querySelectorAll(".quill-table-col-tool__cell"))}checkTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}getClientXFromEvent(e){return this.isTouchDevice?e.touches[0].clientX:e.clientX}}const c=n.a.import("blots/block");class u extends c{static create(e){"string"==typeof e&&(e={value:e});const t=super.create(e.value);return y.forEach(l=>{e[l]&&t.setAttribute("data-"+l,e[l])}),w.forEach(l=>{e[l]&&t.setAttribute("data-"+l,e[l])}),t}static formats(e){const t={};return t.value=this.tagName.indexOf(e.tagName)+1,w.concat(y).reduce((t,l)=>(e.hasAttribute("data-"+l)&&(t[l]=e.getAttribute("data-"+l)||void 0),t),t)}format(e,t){const{row:l,cell:o,rowspan:n,colspan:i}=u.formats(this.domNode);e===u.blotName?t?super.format(e,{value:t,row:l,cell:o,rowspan:n,colspan:i}):l?this.replaceWith(x.blotName,{row:l,cell:o,rowspan:n,colspan:i}):super.format(e,t):super.format(e,t)}optimize(){const{row:e,rowspan:t,colspan:l}=u.formats(this.domNode);if(!e||this.parent instanceof q||this.wrap(q.blotName,{row:e,colspan:l,rowspan:t}),this.enforceAllowedChildren(),null!=this.uiNode&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),0===this.children.length)if(null!=this.statics.defaultChild){const e=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(e)}else this.remove();this.cache={}}}u.blotName="header",u.tagName=["H1","H2","H3","H4","H5","H6"];var h=u;const p=n.a.import("blots/break"),b=n.a.import("blots/block"),f=n.a.import("blots/container"),m=["width"],g={width:100},y=["row","cell"],w=["rowspan","colspan"],N={rowspan:1,colspan:1};class x extends b{static create(e){const t=super.create(e);return y.forEach(l=>{let o="row"===l?A:L;t.setAttribute("data-"+l,e[l]||o())}),w.forEach(l=>{t.setAttribute("data-"+l,e[l]||N[l])}),e["cell-bg"]&&t.setAttribute("data-cell-bg",e["cell-bg"]),t}static formats(e){return w.concat(y).concat(["cell-bg"]).reduce((t,l)=>(e.hasAttribute("data-"+l)&&(t[l]=e.getAttribute("data-"+l)||void 0),t),{})}format(e,t){if(w.concat(y).indexOf(e)>-1)t?this.domNode.setAttribute("data-"+e,t):this.domNode.removeAttribute("data-"+e);else if("cell-bg"===e)t?this.domNode.setAttribute("data-cell-bg",t):this.domNode.removeAttribute("data-cell-bg");else if("header"===e){if(!t)return;const{row:l,cell:o,rowspan:n,colspan:i}=x.formats(this.domNode);super.format(e,{value:t,row:l,cell:o,rowspan:n,colspan:i})}else super.format(e,t)}optimize(e){const t=this.domNode.getAttribute("data-row"),l=this.domNode.getAttribute("data-rowspan"),o=this.domNode.getAttribute("data-colspan"),n=this.domNode.getAttribute("data-cell-bg");!this.statics.requiredContainer||this.parent instanceof this.statics.requiredContainer||this.wrap(this.statics.requiredContainer.blotName,{row:t,colspan:o,rowspan:l,"cell-bg":n}),super.optimize(e)}tableCell(){return this.parent}}x.blotName="table-cell-line",x.className="quill-table__cell-line",x.tagName="P";class q extends f{checkMerge(){if(super.checkMerge()&&null!=this.next.children.head){const e=this.children.head.formats()[this.children.head.statics.blotName],t=this.children.tail.formats()[this.children.tail.statics.blotName],l=this.next.children.head.formats()[this.next.children.head.statics.blotName],o=this.next.children.tail.formats()[this.next.children.tail.statics.blotName];return e.cell===t.cell&&e.cell===l.cell&&e.cell===o.cell}return!1}static create(e){const t=super.create(e);return t.setAttribute("data-row",e.row),w.forEach(l=>{e[l]&&t.setAttribute(l,e[l])}),e["cell-bg"]&&(t.setAttribute("data-cell-bg",e["cell-bg"]),t.style.backgroundColor=e["cell-bg"]),t}static formats(e){const t={};return e.hasAttribute("data-row")&&(t.row=e.getAttribute("data-row")),e.hasAttribute("data-cell-bg")&&(t["cell-bg"]=e.getAttribute("data-cell-bg")),w.reduce((t,l)=>(e.hasAttribute(l)&&(t[l]=e.getAttribute(l)),t),t)}cellOffset(){return this.parent?this.parent.children.indexOf(this):-1}formats(){const e={};return this.domNode.hasAttribute("data-row")&&(e.row=this.domNode.getAttribute("data-row")),this.domNode.hasAttribute("data-cell-bg")&&(e["cell-bg"]=this.domNode.getAttribute("data-cell-bg")),w.reduce((e,t)=>(this.domNode.hasAttribute(t)&&(e[t]=this.domNode.getAttribute(t)),e),e)}toggleAttribute(e,t){t?this.domNode.setAttribute(e,t):this.domNode.removeAttribute(e)}formatChildren(e,t){this.children.forEach(l=>{l.format(e,t)})}format(e,t){w.indexOf(e)>-1?(this.toggleAttribute(e,t),this.formatChildren(e,t)):["row"].indexOf(e)>-1?(this.toggleAttribute("data-"+e,t),this.formatChildren(e,t)):"cell-bg"===e?(this.toggleAttribute("data-cell-bg",t),this.formatChildren(e,t),this.domNode.style.backgroundColor=t||"initial"):super.format(e,t)}optimize(e){const t=this.domNode.getAttribute("data-row");!this.statics.requiredContainer||this.parent instanceof this.statics.requiredContainer||this.wrap(this.statics.requiredContainer.blotName,{row:t}),super.optimize(e)}row(){return this.parent}rowOffset(){return this.row()?this.row().rowOffset():-1}table(){return this.row()&&this.row().table()}}q.blotName="table",q.className="quill-table__cell",q.tagName="TD";class v extends f{checkMerge(){if(super.checkMerge()&&null!=this.next.children.head){const e=this.children.head.formats(),t=this.children.tail.formats(),l=this.next.children.head.formats(),o=this.next.children.tail.formats();return e.row===t.row&&e.row===l.row&&e.row===o.row}return!1}static create(e){const t=super.create(e);return t.setAttribute("data-row",e.row),t}formats(){return["row"].reduce((e,t)=>(this.domNode.hasAttribute("data-"+t)&&(e[t]=this.domNode.getAttribute("data-"+t)),e),{})}optimize(){!this.statics.requiredContainer||this.parent instanceof this.statics.requiredContainer||this.wrap(this.statics.requiredContainer.blotName),this.enforceAllowedChildren(),null!=this.uiNode&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),this.children.length>0&&null!=this.next&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}rowOffset(){return this.parent?this.parent.children.indexOf(this):-1}table(){return this.parent&&this.parent.parent}}v.blotName="table-row",v.tagName="TR";class C extends f{}C.blotName="table-body",C.tagName="TBODY";class T extends b{static create(e){let t=super.create(e);return m.forEach(l=>{t.setAttribute(""+l,e[l]||g[l])}),t}static formats(e){return m.reduce((t,l)=>(e.hasAttribute(""+l)&&(t[l]=e.getAttribute(""+l)||void 0),t),{})}formats(e){const t=super.formats();return e&&this.domNode.setAttribute("width",e),t}format(e,t){m.indexOf(e)>-1?this.domNode.setAttribute(""+e,t||g[e]):super.format(e,t)}html(){return this.domNode.outerHTML}}T.blotName="table-col",T.tagName="col";class S extends f{}S.blotName="table-col-group",S.tagName="colgroup";class _ extends f{static create(){return super.create()}constructor(e,t){super(e,t),this.updateTableWidth()}updateTableWidth(){setTimeout(()=>{const e=this.colGroup();if(!e)return;const t=this.domNode.clientWidth;e.children.reduce((e,l)=>{const o=(l.domNode.clientWidth/t*100).toFixed(2);return l.formats(o+"%"),null})},0)}cells(e){return this.rows().map(t=>t.children.at(e))}colGroup(){return this.children.head}deleteColumns(e,t=[],l){const[o]=this.descendants(C);if(null==o||null==o.children.head)return;const n=this.descendants(q),i=[],s=[];if(n.forEach(t=>{const o=r(t.domNode.getBoundingClientRect(),l);o.x+5>e.x&&o.x1-5<e.x1?i.push(t):o.x<e.x+5&&o.x1>e.x1-5&&s.push(t)}),i.length===n.length)return this.tableDestroy(),!0;t.forEach(()=>{this.colGroup().children.at(t[0]).remove()}),i.forEach(e=>{e.remove()}),s.forEach(e=>{const l=parseInt(e.formats().colspan,10);e.format("colspan",l-t.length)}),this.updateTableWidth()}deleteRow(e,t){const[l]=this.descendants(C);if(null==l||null==l.children.head)return;const o=this.descendants(q),n=this.descendants(v),i=[],s=[],a=[],d=n.filter(l=>{const o=r(l.domNode.getBoundingClientRect(),t);return o.y>e.y-5&&o.y1<e.y1+5});if(o.forEach(l=>{const o=r(l.domNode.getBoundingClientRect(),t);o.y>e.y-5&&o.y1<e.y1+5?i.push(l):o.y<e.y+5&&o.y1>e.y1-5&&(s.push(l),Math.abs(o.y-e.y)<5&&a.push(l))}),i.length===o.length)return void this.tableDestroy();const c=this.rows().reduce((l,o)=>{let n=r(o.domNode.getBoundingClientRect(),t);return n.y>e.y-5&&n.y1<e.y1+5&&(l+=1),l},0);a.forEach(e=>{const l=r(e.domNode.getBoundingClientRect(),t),o=e.parent.next,n=o.children.reduce((e,o)=>{const n=r(o.domNode.getBoundingClientRect(),t);return Math.abs(l.x1-n.x)<5&&(e=o),e},null);o.insertBefore(e,n),e.format("row",o.formats().row)}),i.forEach(e=>{e.remove()}),s.forEach(e=>{const t=parseInt(e.formats().rowspan,10);e.format("rowspan",t-c)}),d.forEach(e=>e.remove())}tableDestroy(){const e=n.a.find(this.scroll.domNode.parentNode),t=e.getModule("quill-table");this.remove(),t.hideTableTools(),e.update(n.a.sources.USER)}insertCell(e,t){const l=L(),o=e.formats().row,n=this.scroll.create(q.blotName,Object.assign({},N,{row:o})),i=this.scroll.create(x.blotName,{row:o,cell:l});n.appendChild(i),t?e.insertBefore(n,t):e.appendChild(n)}insertColumn(e,t,l=!0,o){const[n]=this.descendants(C),[i]=this.descendants(S),s=this.descendants(T);let a=[],d=[],c=[];if(null==n||null==n.children.head)return;this.descendants(q).forEach(t=>{const n=r(t.domNode.getBoundingClientRect(),o);l?Math.abs(n.x1-e.x1)<5?a.push(t):e.x1-n.x>5&&e.x1-n.x1<-5&&d.push(t):Math.abs(n.x-e.x)<5?a.push(t):e.x-n.x>5&&e.x-n.x1<-5&&d.push(t)}),a.forEach(e=>{const t=l?e.next:e,o=L(),n=e.parent,i=n.formats().row,r=e.formats(),s=this.scroll.create(q.blotName,Object.assign({},N,{row:i,rowspan:r.rowspan})),a=this.scroll.create(x.blotName,{row:i,cell:o,rowspan:r.rowspan});s.appendChild(a),t?n.insertBefore(s,t):n.appendChild(s),c.push(s)});const u=this.scroll.create(T.blotName,!0);let h=l?s[t].next:s[t];return h?i.insertBefore(u,h):i.appendChild(u),d.forEach(e=>{const t=e.formats().colspan;e.format("colspan",parseInt(t,10)+1),c.push(e)}),c.sort((e,t)=>e.domNode.getBoundingClientRect().y-t.domNode.getBoundingClientRect().y),this.updateTableWidth(),c}insertRow(e,t,l){const[o]=this.descendants(C);if(null==o||null==o.children.head)return;const n=this.descendants(q),i=A(),s=this.scroll.create(v.blotName,{row:i});let a=[],d=[],c=[];n.forEach(o=>{const n=r(o.domNode.getBoundingClientRect(),l);t?Math.abs(n.y1-e.y1)<5?a.push(o):e.y1-n.y>5&&e.y1-n.y1<-5&&d.push(o):Math.abs(n.y-e.y)<5?a.push(o):e.y-n.y>5&&e.y-n.y1<-5&&d.push(o)});const u=(e,t)=>e.domNode.getBoundingClientRect().x-t.domNode.getBoundingClientRect().x;a.sort(u),a.forEach(e=>{const t=L(),l=e.formats(),o=this.scroll.create(q.blotName,Object.assign({},N,{row:i,colspan:l.colspan})),n=this.scroll.create(x.blotName,{row:i,cell:t,colspan:l.colspan}),r=this.scroll.create(p.blotName);n.appendChild(r),o.appendChild(n),s.appendChild(o),c.push(o)}),d.forEach(e=>{const t=parseInt(e.formats().rowspan,10);e.format("rowspan",t+1),c.push(e)});const h=this.rows().find(o=>{let n=r(o.domNode.getBoundingClientRect(),l);return t?Math.abs(n.y-e.y-e.height)<5:Math.abs(n.y-e.y)<5});return o.insertBefore(s,h),c.sort(u),c}mergeCells(e,t,l,o){const n=t.reduce((e,t,n)=>(0!==n?(e&&t.moveChildren(e),t.remove()):(t.format("colspan",o),t.format("rowspan",l),e=t),e),null);let i=n.domNode.getAttribute("data-row"),r=n.children.head.domNode.getAttribute("data-cell");return n.children.forEach(e=>{e.format("cell",r),e.format("row",i),e.format("colspan",o),e.format("rowspan",l)}),n}unmergeCells(e,t){let l={},o=1,n=1;e.forEach(e=>{if(l=e.formats(),o=l.rowspan,n=l.colspan,n>1){let t=e.next,l=e.row();e.format("colspan",1);for(let e=n;e>1;e--)this.insertCell(l,t)}if(o>1){let l=o,i=e.row().next;for(;l>1;){let o=i.children.reduce((l,o)=>{let n=r(e.domNode.getBoundingClientRect(),t),i=r(o.domNode.getBoundingClientRect(),t);return Math.abs(n.x1-i.x)<5&&(l=o),l},null);for(let e=n;e>0;e--)this.insertCell(i,o);l-=1,i=i.next}e.format("rowspan",1)}})}rows(){const e=this.children.tail;return null==e?[]:e.children.map(e=>e)}}_.blotName="table-container",_.className="quill-table__table",_.tagName="TABLE";class E extends f{constructor(e,t){super(e,t);const l=n.a.find(e.domNode.parentNode);t.addEventListener("scroll",e=>{const t=l.getModule("quill-table");t.columnTool&&(t.columnTool.domNode.scrollLeft=e.target.scrollLeft),t.tableSelection&&t.tableSelection.selectedTds.length>0&&t.tableSelection.repositionHelpLines()},!1)}table(){return this.children.head}}function A(){return"row-"+Math.random().toString(36).slice(2,6)}function L(){return"cell-"+Math.random().toString(36).slice(2,6)}E.blotName="table-view",E.className="quill-table__wrapper",E.tagName="DIV",E.allowedChildren=[_],_.requiredContainer=E,_.allowedChildren=[C,S],C.requiredContainer=_,C.allowedChildren=[v],v.requiredContainer=C,v.allowedChildren=[q],q.requiredContainer=v,q.allowedChildren=[x,h],x.requiredContainer=q,S.allowedChildren=[T],S.requiredContainer=_,T.requiredContainer=S;class O{constructor(e,t){this.quill=e,this.cellNode=t.cellNode,this.init(t)}init({tableNode:e,rowNode:t}){const l=this.quill.root.parentNode;this.domNode=document.createElement("button"),this.domNode.classList.add("quill-table-operation-menu__context-btn"),this.domNode.type="button",this.domNode.addEventListener("click",l=>{const o=this.quill.getModule("quill-table"),n=o.tableSelection;n&&n.selectedTds.length<=1&&n.highlitSelection(this.cellNode),o.showTableOperationMenu(e,t,this.cellNode,l)}),this.calculateButtonPosition(),l.appendChild(this.domNode)}calculateButtonPosition(){const e=this.quill.root.parentNode,t=r(this.cellNode.getBoundingClientRect(),e);i(this.domNode,{top:t.y+"px",left:t.x1+"px"})}destroy(){return this.domNode&&this.domNode.remove(),null}}function I(e,t,l,o){return e.reduce((n,i)=>{let s=r(i.getBoundingClientRect(),o);return l(s,t)&&n.push(e.indexOf(i)),n},[])}function k(e,t){const l={row:null,col:null},o=e.closest&&e.closest("tr"),n=function(e){const t=e.closest&&e.closest("tr");if(!t)return-1;return Array.from(t.children).indexOf(e)}(e);n>-1&&(l.col=n);const i=t.indexOf(o);return i>-1&&(l.row=i),l}const R=["left","right","top","bottom"];class B{constructor({table:e,cell:t,row:l},o,n){if(!e)return null;this.table=e,this.rowNode=l,this.cellNode=t,this.quill=o,this.options=n,this.boundary={},this.selectedTds=[],this.dragging=!1,this.selectingHandler=this.mouseDownHandler.bind(this),this.clearSelectionHandler=this.clearSelection.bind(this),this.helpLinesInitial(),this.quill.root.addEventListener("mousedown",this.selectingHandler,!1),this.quill.root.addEventListener("keydown",()=>this.selectCell(),!1),this.quill.on("text-change",e=>{if(0===this.selectedTds.length)return;const t=this.selectedTds.slice(1);1!==this.selectedTds.length?(this.clearSelectionHandler(),this.applyChangesForSelection(t,e)):this.refreshHelpLinesPosition()}),t&&this.highlitSelection(t)}helpLinesInitial(){let e=this.quill.root.parentNode;R.forEach(t=>{this[t]=document.createElement("div"),this[t].classList.add("quill-table__selection-line"),this[t].classList.add("quill-table__selection-line-"+t),i(this[t],{position:"absolute",display:"none","background-color":"#0589f3"}),e.appendChild(this[t])})}mouseDownHandler(e){if(0!==e.button||!e.target.closest(".quill-table__table"))return;let t=null;this.quill.root.addEventListener("mousemove",a,!1),this.quill.root.addEventListener("mouseup",d,!1),this.quill.root.addEventListener("mouseleave",c,!1);let l;this.table.querySelectorAll(".quill-table__cell-line--selected").forEach(e=>{e.classList.remove("quill-table__cell-line--selected")});const o=this.quill.root.parentNode.querySelectorAll(".quill-table__selection-line");o.forEach(e=>{e.addEventListener("mouseup",d,!1)});const n=this;this.dragging=!0;const{startTd:i,startTdRect:s}=this.highlitSelection(e.target);function a(e){if(0!==e.button||!e.target.closest(".quill-table__table"))return;if(t&&clearTimeout(t),l=e.target.closest("td[data-row]"),!l)return;const o=r(l.getBoundingClientRect(),n.quill.root.parentNode);n.boundary=M(s,o),n.correctBoundary(),n.selectedTds=n.computeSelectedTds(i,l),setTimeout(()=>{n.refreshHelpLinesPosition(),n.showContextMenuButton(l)},0),i!==l&&n.quill.blur()}function d(){t&&clearTimeout(t),n.quill.root.removeEventListener("mousemove",a,!1),n.quill.root.removeEventListener("mouseup",d,!1),n.quill.root.removeEventListener("mouseleave",c,!1),o.forEach(e=>{e.removeEventListener("mouseup",d,!1)}),n.dragging=!1,n.selectCell(),n.showContextMenuButton(l||i)}function c(e){n.dragging&&(function(e){const t=e.relatedTarget&&e.relatedTarget.closest&&e.relatedTarget.closest(".quill-table__wrapper"),l=e.relatedTarget&&e.relatedTarget.classList.contains("quill-table__selection-line"),o=e.relatedTarget&&e.relatedTarget.classList.contains("quill-table-operation-menu__context-btn");return t||l||o}(e)||(t&&clearTimeout(t),t=setTimeout(()=>{d()},550)))}}highlitSelection(e){const t=e.closest("td[data-row]"),l=r(t.getBoundingClientRect(),this.quill.root.parentNode);return this.boundary=M(l,l),this.correctBoundary(),this.selectedTds=this.computeSelectedTds(t,t),this.repositionHelpLines(),this.showContextMenuButton(t),{startTd:t,startTdRect:l}}correctBoundary(){n.a.find(this.table).descendants(q).forEach(e=>{let{x:t,y:l,width:o,height:n}=r(e.domNode.getBoundingClientRect(),this.quill.root.parentNode);(t+2>=this.boundary.x&&t+2<=this.boundary.x1||t-2+o>=this.boundary.x&&t-2+o<=this.boundary.x1)&&(l+2>=this.boundary.y&&l+2<=this.boundary.y1||l-2+n>=this.boundary.y&&l-2+n<=this.boundary.y1)&&(this.boundary=M(this.boundary,{x:t,y:l,width:o,height:n}))})}computeSelectedTds(e,t){if("TD"!==e.tagName||"TD"!==t.tagName)return[];const l=Array.from(this.table.querySelectorAll("tr")),o=k(e,l);if(null===o.row||null===o.col)return[];const i=k(t,l);if(null===!i.row||null===i.col)return[];const r=[],{iterationStart:s,iterationEnd:a,beginSelectionIndex:d,endSelectionIndex:c}=(u=o,h=i,{iterationStart:Math.min(u.row,h.row),iterationEnd:Math.max(u.row,h.row),beginSelectionIndex:Math.min(u.col,h.col),endSelectionIndex:Math.max(u.col,h.col)});var u,h;for(let e=s;e<=a;e++){const t=Array.from(l[e].children).slice(d,c+1);r.push(...t.map(e=>n.a.find(e)))}return r}repositionHelpLines(){if(!(this.left&&this.right&&this.top&&this.bottom))return;const e=this.table.parentNode.scrollLeft;i(this.left,{display:"block",left:this.boundary.x-e-1+"px",top:this.boundary.y+"px",height:this.boundary.height+1+"px",width:"1px"}),i(this.right,{display:"block",left:this.boundary.x1-e+"px",top:this.boundary.y+"px",height:this.boundary.height+1+"px",width:"1px"}),i(this.top,{display:"block",left:this.boundary.x-1-e+"px",top:this.boundary.y+"px",width:this.boundary.width+1+"px",height:"1px"}),i(this.bottom,{display:"block",left:this.boundary.x-1-e+"px",top:this.boundary.y1+1+"px",width:this.boundary.width+1+"px",height:"1px"})}refreshHelpLinesPosition(){if(0===this.selectedTds.length)return;const e=r(this.selectedTds[0].domNode.getBoundingClientRect(),this.quill.root.parentNode),t=r(this.selectedTds[this.selectedTds.length-1].domNode.getBoundingClientRect(),this.quill.root.parentNode);this.contextMenuButton&&this.contextMenuButton.calculateButtonPosition(),this.boundary=M(e,t),this.repositionHelpLines()}destroy(){return R.forEach(e=>{this[e].remove(),this[e]=null}),this.quill.root.removeEventListener("mousedown",this.selectingHandler,!1),this.quill.off("text-change",this.clearSelectionHandler),this.hideContextMenuButton(),null}setSelection(e,t){const l=e.getBoundingClientRect(),o=t.getBoundingClientRect();this.boundary=M(r(l,this.quill.root.parentNode),r(o,this.quill.root.parentNode)),this.correctBoundary(),this.selectedTds=this.computeSelectedTds(e,t),setTimeout(()=>{this.refreshHelpLinesPosition(),this.showContextMenuButton(this.selectedTds[this.selectedTds.length-1].domNode)},0)}clearSelection(){this.selectedTds.length>1&&window.getSelection().removeAllRanges(),this.boundary={},this.selectedTds=[],R.forEach(e=>{this[e]&&i(this[e],{display:"none"})}),this.hideContextMenuButton()}selectCell(){if(this.selectedTds.length<=1)return;const e=this.selectedTds[0],t=window.getSelection();t.removeAllRanges();const l=document.createRange();l.setStart(e.domNode,0),l.setEnd(e.domNode,1),t.addRange(l),this.selectedTds.forEach(e=>{e.domNode.classList.add("quill-table__cell-line--selected")})}keyDownButtonHandler(){this.selectCell()}applyChangesForSelection(e,t){const l=t.ops.reduce((e,t)=>t.attributes?(Object.entries(t.attributes).forEach(([t,l])=>{e[t]=l}),e):e,{});e.forEach(e=>{const t=this.quill.getIndex(e);this.quill.formatLine(t,0,l),this.quill.formatText(t,e.domNode.textContent.length,l)}),this.quill.setSelection(null)}showContextMenuButton(e){this.hideContextMenuButton(),this.contextMenuButton=new O(this.quill,{tableNode:this.table,rowNode:this.rowNode,cellNode:e})}hideContextMenuButton(){this.contextMenuButton&&(this.contextMenuButton=this.contextMenuButton.destroy())}}function M(e,t){let l=Math.min(e.x,t.x,e.x+e.width-1,t.x+t.width-1),o=Math.max(e.x,t.x,e.x+e.width-1,t.x+t.width-1),n=Math.min(e.y,t.y,e.y+e.height-1,t.y+t.height-1),i=Math.max(e.y,t.y,e.y+e.height-1,t.y+t.height-1);return{x:l,x1:o,y:n,y1:i,width:o-l,height:i-n}}const D={RU:{table:"Таблица",insert_column_right:"Добавить колонку справа",insert_column_left:"Добавить колонку слева",insert_row_up:"Добавить строку сверху",insert_row_bottom:"Добавить строку снизу",merge_cells:"Объединить ячейки",unmerge_cells:"Разъединить ячейку",delete_columns:"Удалить столбец",delete_rows:"Удалить строку",delete_table:"Удалить таблицу"},EN:{table:"Table",insert_column_right:"Insert column right",insert_column_left:"Insert column left",insert_row_up:"Insert row up",insert_row_bottom:"Insert row down",merge_cells:"Merge selected cells",unmerge_cells:"Unmerge cells",delete_columns:"Delete selected columns",delete_rows:"Delete selected rows",delete_table:"Delete table"}};function H(e,t){const l=t||window.lang||"EN";return(D[l]||D.EN)[e]||D.EN[e]||e}const j=["white","red","yellow","blue"],P={insertColumnRight:{text:H("insert_column_right"),iconClass:"quill-table-operation-menu__icon-add-column-right",handler(){const e=n.a.find(this.table),t=this.selectedTds[this.selectedTds.length-1],l=t.domNode.parentNode.querySelectorAll(".quill-table__cell");let o=Array.from(l).indexOf(t.domNode);const i=e.insertColumn(this.boundary,o,!0,this.quill.root.parentNode);this.quill.update(n.a.sources.SILENT),this.quill.setSelection(this.quill.getIndex(i[0]),0,n.a.sources.SILENT),this.tableSelection.setSelection(i[0].domNode,i[0].domNode),this.tableColumnTool.updateToolCells()}},insertColumnLeft:{text:H("insert_column_left"),iconClass:"quill-table-operation-menu__icon-add-column-left",handler(){const e=n.a.find(this.table),t=this.selectedTds[0],l=t.domNode.parentNode.querySelectorAll(".quill-table__cell");let o=Array.from(l).indexOf(t.domNode);const i=e.insertColumn(this.boundary,o,!1,this.quill.root.parentNode);this.quill.update(n.a.sources.SILENT),this.quill.setSelection(this.quill.getIndex(i[0]),0,n.a.sources.SILENT),this.tableSelection.setSelection(i[0].domNode,i[0].domNode),this.tableColumnTool.updateToolCells()}},insertRowUp:{text:H("insert_row_up"),iconClass:"quill-table-operation-menu__icon-add-column-top",handler(){const e=n.a.find(this.table).insertRow(this.boundary,!1,this.quill.root.parentNode);this.quill.update(n.a.sources.SILENT),this.quill.setSelection(this.quill.getIndex(e[0]),0,n.a.sources.SILENT),this.tableSelection.setSelection(e[0].domNode,e[0].domNode)}},insertRowDown:{text:H("insert_row_bottom"),iconClass:"quill-table-operation-menu__icon-add-column-bottom",handler(){const e=n.a.find(this.table).insertRow(this.boundary,!0,this.quill.root.parentNode);this.quill.update(n.a.sources.SILENT),this.quill.setSelection(this.quill.getIndex(e[0]),0,n.a.sources.SILENT),this.tableSelection.setSelection(e[0].domNode,e[0].domNode)}},mergeCells:{text:H("merge_cells"),iconClass:"quill-table-operation-menu__icon-merge-cells",handler(){const e=n.a.find(this.table),t=e.rows().reduce((e,t)=>{let l=r(t.domNode.getBoundingClientRect(),this.quill.root.parentNode);return l.y>this.boundary.y-5&&l.y+l.height<this.boundary.y+this.boundary.height+5&&(e+=1),e},0),l=this.columnToolCells.reduce((e,t)=>{let l=r(t.getBoundingClientRect(),this.quill.root.parentNode);return l.x>this.boundary.x-5&&l.x+l.width<this.boundary.x+this.boundary.width+5&&(e+=1),e},0),o=e.mergeCells(this.boundary,this.selectedTds,t,l,this.quill.root.parentNode);this.quill.update(n.a.sources.SILENT),this.tableSelection.setSelection(o.domNode,o.domNode)}},unmergeCells:{text:H("unmerge_cells"),iconClass:"quill-table-operation-menu__icon-slpit-cells",handler(){n.a.find(this.table).unmergeCells(this.selectedTds,this.quill.root.parentNode),this.quill.update(n.a.sources.SILENT),this.tableSelection.clearSelection()}},deleteColumn:{text:H("delete_columns"),iconClass:"quill-table-operation-menu__icon-remove-column",handler(){const e=n.a.find(this.table);let t=I(this.columnToolCells,this.boundary,(e,t)=>e.x+5>t.x&&e.x+e.width-5<t.x1,this.quill.root.parentNode);e.deleteColumns(this.boundary,t,this.quill.root.parentNode)||(this.quill.update(n.a.sources.SILENT),this.tableSelection.clearSelection(),this.tableColumnTool.updateToolCells())}},deleteRow:{text:H("delete_rows"),iconClass:"quill-table-operation-menu__icon-remove-row",handler(){n.a.find(this.table).deleteRow(this.boundary,this.quill.root.parentNode),this.quill.update(n.a.sources.SILENT),this.tableSelection.clearSelection()}},deleteTable:{text:H("delete_table"),iconClass:"quill-table-operation-menu__icon-delete-table",handler(){const e=this.quill.getModule("quill-table"),t=n.a.find(this.table);e.hideTableTools(),t.remove(),this.quill.update(n.a.sources.SILENT)}}};class U{constructor(e,t,l={}){const o=t.getModule("quill-table");this.tableSelection=o.tableSelection,this.table=e.table,this.quill=t,this.options=l,this.menuItems=Object.assign({},P,l.items||{}),this.tableColumnTool=o.columnTool,this.boundary=this.tableSelection.boundary,this.selectedTds=this.tableSelection.selectedTds,this.destroyHandler=this.destroy.bind(this),this.columnToolCells=this.tableColumnTool.colToolCells(),this.colorSubTitle=l.color&&l.color.text?l.color.text:"Background Colors",this.cellColors=l.color&&l.color.colors?l.color.colors:j,this.evt=e.evt,this.menuInitial(e),this.mount(),document.addEventListener("click",this.destroyHandler,!1)}mount(){document.body.appendChild(this.domNode);const{left:e,top:t}=this.calculatePosition();i(this.domNode,{left:e+"px",top:t+"px"})}destroy(){return this.domNode.remove(),document.removeEventListener("click",this.destroyHandler,!1),null}menuInitial(){this.domNode=document.createElement("div"),this.domNode.classList.add("quill-table-operation-menu"),i(this.domNode,{position:"absolute","min-height":"150px","max-width":"min(-10px + 100vw, 300px);"});for(let t in this.menuItems)this.menuItems[t]&&(this.domNode.appendChild(this.menuItemCreator(Object.assign({},P[t],this.menuItems[t]))),["insertRowDown","unmergeCells"].indexOf(t)>-1&&this.domNode.appendChild(e()));function e(){const e=document.createElement("div");return e.classList.add("quill-table-operation-menu__divider"),e}this.options.color&&!1!==this.options.color&&(this.domNode.appendChild(e()),this.domNode.appendChild(function(e){const t=document.createElement("div");return t.classList.add("quill-table-operation-menu__subtitle"),t.innerText=e,t}(this.colorSubTitle)),this.domNode.appendChild(this.colorsItemCreator(this.cellColors)))}colorsItemCreator(e){const t=this,l=document.createElement("div");return l.classList.add("quill-table-color-picker"),e.forEach(e=>{let o=function(e){const l=document.createElement("div");return l.classList.add("quill-table-color-picker__item"),l.setAttribute("data-color",e),l.style.backgroundColor=e,l.addEventListener("click",(function(){const l=t.tableSelection.selectedTds;l&&l.length>0&&l.forEach(t=>{t.format("cell-bg",e)})}),!1),l}(e);l.appendChild(o)}),l}menuItemCreator({text:e,iconClass:t,handler:l}){const o=document.createElement("div");o.classList.add("quill-table-operation-menu__item");const n=document.createElement("span");n.classList.add("quill-table-operation-menu__icon"),n.classList.add(t);const i=document.createElement("span");return i.classList.add("quill-table-operation-menu__text"),i.innerText=e,o.appendChild(n),o.appendChild(i),o.addEventListener("click",l.bind(this),!1),o}calculatePosition(){const e=parseInt(this.evt.clientX,10)||0,t=parseInt(this.evt.clientY,10)||0,{clientWidth:l,clientHeight:o}=document.documentElement,{offsetWidth:n,offsetHeight:i}=this.domNode;let r=e+5;e+n>l-5&&(r=e-n-5,r<5&&(r=5));let s=this.evt.pageY;return t+i>o&&(s=this.evt.pageY-i,s<150&&(s=150)),{top:s,left:r}}}const W=n.a.import("delta");function z(e,t){const l=e.parentNode,o="TABLE"===l.parentNode.tagName?l.parentNode:l.parentNode.parentNode,n=Array.from(o.querySelectorAll("tr")),i=Array.from(l.querySelectorAll("td")),r=n.indexOf(l)+1,a=i.indexOf(e)+1,d=e.getAttribute("colspan")||!1,c=e.getAttribute("rowspan")||!1,u=e.getAttribute("data-cell-bg")||e.style.backgroundColor;return 0===t.length()?t=(new W).insert("\n",{"table-cell-line":{row:r,cell:a,rowspan:c,colspan:d}}):(t=t.reduce((e,t)=>{if(t.insert&&"string"==typeof t.insert){const l=[];let o=t.insert,n=0;for(let e=0;e<t.insert.length;e++)"\n"===o.charAt(e)&&(0===e||l.push(o.substring(n,e)),l.push("\n"),n=e+1);const i=o.substring(n);i&&l.push(i),l.forEach(l=>{"\n"===l?e.insert("\n",t.attributes):e.insert(l,s(t.attributes,["table","table-cell-line"]))})}else e.insert(t.insert,t.attributes);return e},new W)).reduce((e,t)=>t.insert&&"string"==typeof t.insert&&t.insert.startsWith("\n")?(e.insert(t.insert,Object.assign({},Object.assign({},{row:r},t.attributes.table),{"table-cell-line":{row:r,cell:a,rowspan:c,colspan:d,"cell-bg":u}},s(t.attributes,["table"]))),e):(t.attributes&&t.attributes.background&&t.attributes.background===function(e){if(/^(rgb|RGB)/.test(e)){const t=e.toString().match(/\d+/g);let l="#";for(let e=0;e<3;e++)l+=("0"+Number(t[e]).toString(16)).slice(-2);return l}if(/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){const t=e.replace(/#/,"").split("");if(6===t.length)return e;if(3===t.length){let e="#";for(let l=0;l<t.length;l+=1)e+=t[l]+t[l];return e}}return e}(u)?e.insert(t.insert,Object.assign({},s(t.attributes,["table","table-cell-line","background"]))):e.insert(t.insert,Object.assign({},s(t.attributes,["table","table-cell-line"]))),e),new W)}function K(e,t){const l=e.parentNode,o="TABLE"===l.parentNode.tagName?l.parentNode:l.parentNode.parentNode,n=Array.from(o.querySelectorAll("tr")),i=Array.from(l.querySelectorAll("th")),r=n.indexOf(l)+1,a=i.indexOf(e)+1,d=e.getAttribute("colspan")||!1,c=e.getAttribute("rowspan")||!1;return 0===t.length()?t=(new W).insert("\n",{"table-cell-line":{row:r,cell:a,rowspan:c,colspan:d}}):(t=t.reduce((e,t)=>{if(t.insert&&"string"==typeof t.insert){const l=[];let o=t.insert,n=0;for(let e=0;e<t.insert.length;e++)"\n"===o.charAt(e)&&(0===e||l.push(o.substring(n,e)),l.push("\n"),n=e+1);const i=o.substring(n);i&&l.push(i),l.indexOf("\n")<0&&l.push("\n"),l.forEach(l=>{"\n"===l?e.insert("\n",{"table-cell-line":{row:r,cell:a,rowspan:c,colspan:d}}):e.insert(l,t.attributes)})}else e.insert(t.insert,t.attributes);return e},new W)).reduce((e,t)=>(t.insert&&"string"==typeof t.insert&&t.insert.startsWith("\n")?e.insert(t.insert,Object.assign({},{"table-cell-line":{row:r,cell:a,rowspan:c,colspan:d}})):e.insert(t.insert,Object.assign({},s(t.attributes,["table","table-cell-line"]))),e),new W)}function F(e,t){let l=new W;const o=e.querySelector("tr");if(null===o)return l;const n=Array.from(o.querySelectorAll("td")).concat(Array.from(o.querySelectorAll("th"))).reduce((e,t)=>{const l=t.getAttribute("colspan")||1;return e+=parseInt(l,10)},0),i=e.querySelectorAll("col").length;if(i===n)return t;{for(let e=0;e<n-i;e++)l.insert("\n",{"table-col":!0});if(0===i)return l.concat(t);let e=0;return t.reduce((t,o)=>(t.insert(o.insert,o.attributes),o.attributes&&o.attributes["table-col"]&&(e+=o.insert.length,e===i&&(t=t.concat(l))),t),new W)}}const X=n.a.import("core/module"),G=n.a.import("delta");class Y extends X{static register(){n.a.register(T,!0),n.a.register(S,!0),n.a.register(x,!0),n.a.register(q,!0),n.a.register(v,!0),n.a.register(C,!0),n.a.register(_,!0),n.a.register(E,!0)}constructor(e,t){super(e,t),this.quill.root.addEventListener("click",l=>{const o=a(l);if(!o||o.length<=0)return;const{tableNode:n,rowNode:i,cellNode:r}=o.reduce((e,t)=>{if(!t.tagName)return e;const o=t.tagName.toUpperCase();if("TABLE"===o&&t.classList.contains("quill-table__table"))return e.tableNode=t,e;if("TR"===o&&(e.rowNode=t),("TBODY"===o||e.rowNode)&&!e.cellNode){const t=document.elementFromPoint(l.x,l.y);t&&(e.cellNode=t.closest(".quill-table__cell"))}return t.classList.contains("quill-table__cell")&&(e.cellNode=t),e},{cellNode:null,rowNode:null,tableNode:null});if(n){if(this.table===n)return;this.table&&this.hideTableTools(),this.showTableTools(n,i,r,e,t)}else this.table&&this.hideTableTools()},!1),this.quill.root.addEventListener("contextmenu",e=>{if(!this.table)return!0;e.preventDefault();const t=a(e);if(!t||t.length<=0)return;const l=t.filter(e=>e.tagName&&"TABLE"===e.tagName.toUpperCase()&&e.classList.contains("quill-table__table"))[0],o=t.filter(e=>e.tagName&&"TR"===e.tagName.toUpperCase()&&e.getAttribute("data-row"))[0],n=t.filter(e=>e.tagName&&"TD"===e.tagName.toUpperCase()&&e.getAttribute("data-row"))[0];let i=this.tableSelection.selectedTds.map(e=>e.domNode).includes(n);(this.tableSelection.selectedTds.length<=0||!i)&&this.tableSelection.setSelection(n,n),this.showTableOperationMenu(l,o,n,e)},!1),e.keyboard.addBinding({key:"Backspace"},{},(e,t)=>this.tableDeletionProtection(e,t)),e.keyboard.addBinding({key:"Backspace",shiftKey:!0},{},(e,t)=>this.tableDeletionProtection(e,t));let l=e.keyboard.bindings.Backspace.slice(e.keyboard.bindings.Backspace.length-2,e.keyboard.bindings.Backspace.length);e.keyboard.bindings.Backspace.splice(0,2,...l),e.keyboard.bindings.Backspace.splice(e.keyboard.bindings.Backspace.length-2,2);const o=e.keyboard.bindings.Tab.slice(e.keyboard.bindings.Tab.length-2,e.keyboard.bindings.Tab.length);e.keyboard.bindings.Tab.splice(0,2,...o),e.keyboard.bindings.Tab.splice(e.keyboard.bindings.Tab.length-2,2),e.clipboard.addMatcher("td",z),e.clipboard.addMatcher("th",K),e.clipboard.addMatcher("table",F),e.clipboard.matchers=e.clipboard.matchers.filter(e=>"tr"!==e[0]),this.quill.on("selection-change",e=>{this.correctSelection(e)}),window.addEventListener("resize",()=>{this.columnTool&&(this.columnTool.updateToolCells(),this.columnTool.updateToolWidth()),this.tableSelection&&this.tableSelection.refreshHelpLinesPosition()},!1)}getTable(e=this.quill.getSelection()){if(null==e)return[null,null,null,-1];const[t,l]=this.quill.getLine(e.index);if(null==t||t.statics.blotName!==x.blotName)return[null,null,null,-1];const o=t.tableCell(),n=o.row();return[n.table(),n,o,l]}insertTable(e,t){const l=this.quill.getSelection(!0);if(null==l)return;let o=this.quill.getLeaf(l.index)[0];if(i=o,Boolean(i.domNode.closest&&i.domNode.closest("table")))return void console.warn("Can not insert table into a table cell.");var i;let r=(new G).retain(l.index);r.insert("\n"),r=new Array(t).fill("\n").reduce((e,t)=>(e.insert(t,{"table-col":!0}),e),r),r=new Array(e).fill(0).reduce(e=>{let l=A();return new Array(t).fill("\n").reduce((e,t)=>(e.insert(t,{"table-cell-line":{row:l,cell:L()}}),e),e)},r),this.quill.updateContents(r,n.a.sources.USER);const s=l.index+t+1;this.quill.setSelection(s,n.a.sources.API);const[a]=this.quill.getLine(s);if(!J(a))return;const d=a.parent;if(!d)return;const c=d.parent;if(!c)return;const u=c.domNode.closest("table");u&&this.showTableTools(u,c.domNode,d.domNode,this.quill,this.options)}tableInsertColumn(e){const t=n.a.find(this.table),l=this.tableSelection,o=this.columnTool;let i=function(e,t,l,o){return e.reduce((n,i)=>{let s=r(i.getBoundingClientRect(),o);return l(s,t)&&(n=e.indexOf(i)),n},!1)}(o.colToolCells(),l.boundary,(e,t)=>Math.abs(e.x+e.width-t.x1)<=5,l.quill.root.parentNode);const s=t.insertColumn(l.boundary,i,"right"===e,l.quill.root.parentNode);o.updateToolCells(),l.quill.update(n.a.sources.USER),l.quill.setSelection(l.quill.getIndex(s[0]),0,n.a.sources.SILENT),l.setSelection(s[0].domNode,s[0].domNode)}insertColumnLeft(){this.tableInsertColumn("left")}insertColumnRight(){this.tableInsertColumn("right")}tableInsertRow(e){const t=n.a.find(this.table),l=this.tableSelection,o=t.insertRow(l.boundary,"below"===e,l.quill.root.parentNode);l.quill.update(n.a.sources.USER),l.quill.setSelection(l.quill.getIndex(o[0]),0,n.a.sources.SILENT),l.setSelection(o[0].domNode,o[0].domNode)}insertRowAbove(){this.tableInsertRow("above")}insertRowBelow(){this.tableInsertRow("below")}deleteRow(){const e=n.a.find(this.table),t=this.tableSelection;e.deleteRow(t.boundary,t.quill.root.parentNode),t.quill.update(n.a.sources.USER),t.clearSelection()}deleteColumn(){const e=n.a.find(this.table),t=this.tableSelection,l=this.columnTool;let o=I(l.colToolCells(),t.boundary,(e,t)=>e.x+5>t.x&&e.x+e.width-5<t.x1,t.quill.root.parentNode);e.deleteColumns(t.boundary,o,t.quill.root.parentNode)||(l.updateToolCells(),t.quill.update(n.a.sources.USER),t.clearSelection())}deleteTable(){n.a.find(this.table).tableDestroy()}showTableTools(e,t,l,o,n){this.table=e,this.columnTool=new d(e,o,n),this.tableSelection=new B({table:e,row:t,cell:l},o,n)}hideTableTools(){this.columnTool&&this.columnTool.destroy(),this.tableSelection&&this.tableSelection.destroy(),this.tableOperationMenu&&this.tableOperationMenu.destroy(),this.columnTool=null,this.tableSelection=null,this.tableOperationMenu=null,this.table=null}showTableOperationMenu(e,t,l,o){this.tableOperationMenu&&(this.tableOperationMenu=this.tableOperationMenu.destroy()),e&&setTimeout(()=>{this.tableOperationMenu=new U({table:e,row:t,cell:l,evt:o},this.quill,this.options.operationMenu)},0)}tableDeletionProtection(e,t){if(0===e.index||this.quill.getLength()<=1)return!0;const[l]=this.quill.getLine(e.index),o=J(l);if((!this.tableSelection||this.tableSelection.selectedTds&&0===this.tableSelection.selectedTds.length)&&o)return!1;if(t.event.shiftKey&&o)return!1;if(this.tableSelection&&this.tableSelection.selectedTds&&this.tableSelection.selectedTds.length>1)return!1;if(0===t.offset){const[t]=this.quill.getLine(e.index-1);if(null!=t&&J(t)&&!o)return!1}return!0}correctSelection(e){if(!e)return;const t=this.quill.getLines(e);if(0===t.length){const[t]=this.quill.getLine(e.index);if(!J(t))return;return void(this.tableSelection?this.tableSelection.selectedTds&&1===this.tableSelection.selectedTds.length&&this.tableSelection.setSelection(t.parent.domNode,t.parent.domNode):this.showTableTools(this.table,t.domNode.closest("tr"),t.parent.domNode,this.quill,this.options))}const l=t.filter(e=>J(e)),o=l.length;if(0===o)return;const n=l[0],i=this.quill.getIndex(n),r=n.domNode.textContent.length;if(1===t.length&&1===o)return 0===r?void this.quill.setSelection(i):void(!n.parent.next&&e.length>=r&&this.quill.setSelection(i,r));const s=t.reduce((e,t)=>e+t.domNode.textContent.length,0);this.quill.setSelection(i,s+o-1)}}function $(e,t=!1){return{key:e?"ArrowUp":"ArrowDown",collapsed:!0,shiftKey:t,format:["table-cell-line"],handler(t,l){const o=e?"prev":"next";if(null!=l.line[o])return!0;const i=l.line.parent,r=i.parent[o];if(null!=r&&"table-row"===r.statics.blotName){let e=r.children.head,t=parseInt(e.formats().colspan,10),l=i,o=parseInt(l.formats().colspan,10);for(;null!=l.prev;)l=l.prev,o+=parseInt(l.formats().colspan,10);for(;null!=e.next&&t<o;)e=e.next,t+=parseInt(e.formats().colspan,10);const s=e.offset(this.quill.scroll);this.quill.setSelection(s,0,n.a.sources.USER)}else{const t=i.table().parent[o];null!=t&&(e?this.quill.setSelection(t.offset(this.quill.scroll)+t.length()-1,0,n.a.sources.USER):this.quill.setSelection(t.offset(this.quill.scroll),0,n.a.sources.USER))}return!1}}}function J(e){return"table-cell-line"===e.statics.blotName}Y.keyboardBindings={"table-cell-line backspace":{key:"Backspace",format:["table-cell-line"],collapsed:!0,offset:0,handler(e){const[t]=this.quill.getLine(e.index);return!(!t.prev||!J(t.prev))}},"table-cell-line delete":{key:"Delete",format:["table-cell-line"],collapsed:!0,suffix:/^$/,handler(){}},"table-cell-line enter":{key:"Enter",shiftKey:null,format:["table-cell-line"],handler(e,t){if(this.quill.selection&&this.quill.selection.composing)return;const l=n.a.imports.parchment.Scope;e.length>0&&this.quill.scroll.deleteAt(e.index,e.length);const o=Object.keys(t.format).reduce((e,o)=>(this.quill.scroll.query(o,l.BLOCK)&&!Array.isArray(t.format[o])&&(e[o]=t.format[o]),e),{});this.quill.insertText(e.index,"\n",o["table-cell-line"],n.a.sources.USER),this.quill.setSelection(e.index+1,n.a.sources.SILENT),this.quill.focus(),Object.keys(t.format).forEach(e=>{null==o[e]&&(Array.isArray(t.format[e])||"link"!==e&&this.quill.format(e,t.format[e],n.a.sources.USER))})}},"table-cell-line up":$(!0),"table-cell-line down":$(!1),"table-cell-line up shift":$(!0,!0),"table-cell-line down shift":$(!1,!0),"down-to-table":{key:"ArrowDown",collapsed:!0,handler(e,t){const l=t.line.next;if(l&&"table-view"===l.statics.blotName){const e=l.table().rows()[0].children.head.children.head;return this.quill.setSelection(e.offset(this.quill.scroll),0,n.a.sources.USER),!1}return!0}},"up-to-table":{key:"ArrowUp",collapsed:!0,handler(e,t){const l=t.line.prev;if(l&&"table-view"===l.statics.blotName){const e=l.table().rows(),t=e[e.length-1].children.head.children.head;return this.quill.setSelection(t.offset(this.quill.scroll),0,n.a.sources.USER),!1}return!0}},"table-cell-line shortKey a":{key:"a",shortKey:!0,format:["table-cell-line"],handler(e,t){if(!e||!J(t.line))return;const l=t.line.parent;let o=0,n=l.children.head;for(;n;)o+=n.domNode.textContent.length,n=n.next;const i=l.children.length-1,r=this.quill.getIndex(l.children.head);this.quill.setSelection(r,o+i)}},"table-cell-line tab":{key:"Tab",format:["table-cell-line"],handler(e,t){if(!J(t.line))return!0;const l=t.line.parent;if(l.next){const e=this.quill.getIndex(t.line.parent.next);return this.quill.setSelection(e,n.a.sources.USER),!1}if(l.parent.next&&l.parent.next.children.length>0){const e=this.quill.getIndex(l.parent.next.children.head);return this.quill.setSelection(e,n.a.sources.USER),!1}return!1}},"table-cell-line shiftKey tab":{key:"Tab",shiftKey:!0,format:["table-cell-line"],handler(e,t){if(!J(t.line))return!0;const l=t.line.parent;if(l.prev){const e=this.quill.getIndex(t.line.parent.prev);return this.quill.setSelection(e,n.a.sources.USER),!1}if(l.parent.prev&&l.parent.prev.children.length>0){const e=this.quill.getIndex(l.parent.prev.children.tail);return this.quill.setSelection(e,n.a.sources.USER),!1}if(l.parent.prev&&l.parent.prev.children.length>0){const e=this.quill.getIndex(l.parent.prev.children.head);return this.quill.setSelection(e,n.a.sources.USER),!1}return!1}}},Y.requiredTableFormats=["table","table-cell-line","table-row","table-body","table-col","table-col-group","table-container","table-view"];t.default=Y}]).default}));